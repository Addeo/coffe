# 🔧 Как настроить SSH доступ к VPS

## ❌ Проблема:

```
user1@192.144.12.102: Permission denied (publickey)
```

Это значит, что VPS принимает только SSH ключи, а пароль отключён.

---

## ✅ Решение A: Добавить SSH ключ через панель Cloud.ru

### Шаг 1: Скопируйте ваш публичный SSH ключ

Выполните на вашем Mac:

```bash
cat ~/.ssh/id_ed25519.pub
```

**Скопируйте всю строку** (начинается с `ssh-ed25519 ...`)

### Шаг 2: Добавьте ключ в Cloud.ru

1. Откройте: https://cloud.ru/
2. Перейдите: **Виртуальные машины** → **vm-46609d42d**
3. Найдите раздел **"SSH ключи"** или **"Безопасность"**
4. Нажмите **"Добавить SSH ключ"**
5. Вставьте скопированный ключ
6. Сохраните

### Шаг 3: Проверьте подключение

```bash
ssh user1@192.144.12.102
# Должно подключиться БЕЗ пароля!
```

---

## ✅ Решение B: Включить вход по паролю (временно)

Если не можете добавить ключ через панель:

### Вариант 1: Через Cloud.ru Console

1. Откройте: https://cloud.ru/
2. Найдите **vm-46609d42d**
3. Нажмите **"Консоль"** или **"VNC Console"**
4. Залогиньтесь как `user1` с паролем `coffeAdmin123!`
5. Выполните:

```bash
# Включить вход по паролю
sudo nano /etc/ssh/sshd_config

# Найдите и измените:
PasswordAuthentication no
# на:
PasswordAuthentication yes

# Сохраните (Ctrl+O, Enter, Ctrl+X)

# Перезапустите SSH:
sudo systemctl restart sshd

# Теперь попробуйте с вашего Mac:
ssh user1@192.144.12.102
```

### Вариант 2: Добавить ключ вручную через консоль

В консоли Cloud.ru выполните:

```bash
# Создать директорию для ключей
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# Добавить ваш публичный ключ
cat >> ~/.ssh/authorized_keys << 'EOF'
ВСТАВЬТЕ_ВАШ_ПУБЛИЧНЫЙ_КЛЮЧ_СЮДА
EOF

chmod 600 ~/.ssh/authorized_keys

# Проверить
cat ~/.ssh/authorized_keys
```

**Ваш публичный ключ для вставки:**

```bash
# На Mac выполните:
cat ~/.ssh/id_ed25519.pub
# Скопируйте вывод
```

---

## 🧪 Проверка SSH после настройки:

```bash
# Проверка 1: Подключение
ssh user1@192.144.12.102 "echo 'SSH works!'"

# Проверка 2: Docker
ssh user1@192.144.12.102 "docker --version"

# Проверка 3: Директория
ssh user1@192.144.12.102 "mkdir -p ~/coffe && cd ~/coffe && pwd"
```

---

## ✅ После настройки SSH:

Запустите скрипт проверки:

```bash
bash check-deployment.sh
```

Вы должны увидеть:

```
2️⃣  ПОДКЛЮЧЕНИЕ К VPS
────────────────────────────────────────────────────────────
SSH подключение: ✅ OK
```

---

## 🚀 Затем продолжайте деплой:

```bash
git commit -m "Deploy to VPS"
git push origin main
```

Проверьте деплой:

```
https://github.com/Addeo/coffe-deploy/actions
```
