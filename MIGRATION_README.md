# üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite –≤ Production MySQL

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **sqlite3** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- **mysql client** - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ production –ë–î

```bash
# macOS
brew install sqlite3
brew install mysql

# Linux (Ubuntu/Debian)
sudo apt-get install sqlite3
sudo apt-get install mysql-client
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ production –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

#### –°–ø–æ—Å–æ–± 1: –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

```bash
export DB_HOST="192.144.12.102"
export DB_PORT="3306"
export DB_USERNAME="coffee_user"
export DB_PASSWORD="your_password_here"
export DB_DATABASE="coffee_admin"
```

#### –°–ø–æ—Å–æ–± 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞ `migrate-to-production.sh`:

```bash
PRODUCTION_HOST="${DB_HOST:-192.144.12.102}"
PRODUCTION_PORT="${DB_PORT:-3306}"
PRODUCTION_USER="${DB_USERNAME:-coffee_user}"
PRODUCTION_PASSWORD="${DB_PASSWORD}"
PRODUCTION_DB="${DB_DATABASE:-coffee_admin}"
```

#### –°–ø–æ—Å–æ–± 3: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ.

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫:

```bash
cd /path/to/coffe  # –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
./migrate-to-production.sh
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:

1. **‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** - —É–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã sqlite3 –∏ mysql
2. **‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å production –ë–î
3. **‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production –ë–î
4. **‚úÖ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - —Ç—Ä–µ–±—É–µ—Ç –≤–≤–µ—Å—Ç–∏ 'yes' –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
5. **‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ production –ë–î
6. **‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç SQLite** - —Å–æ–∑–¥–∞–µ—Ç SQL dump –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
7. **‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç** - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç SQLite —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ MySQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
8. **‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ production –ë–î
9. **‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –≠—Ç–æ –û–ü–ê–°–ù–ê–Ø –æ–ø–µ—Ä–∞—Ü–∏—è!

–°–∫—Ä–∏–ø—Ç **–ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢** –¥–∞–Ω–Ω—ã–µ –≤ production –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

- ‚ùå **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è backup** –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
- ‚úÖ **Backup —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `migration-backup-TIMESTAMP/`

### 2. Backup —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:

```
migration-backup-TIMESTAMP/
‚îú‚îÄ‚îÄ migration-dump-TIMESTAMP.sql          # SQLite dump
‚îú‚îÄ‚îÄ mysql-migration-dump-TIMESTAMP.sql   # MySQL —Ñ–æ—Ä–º–∞—Ç
‚îî‚îÄ‚îÄ production-backup-TIMESTAMP.sql      # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è production
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ production –∏–∑ backup:

```bash
mysql -h 192.144.12.102 -P 3306 -u coffee_user -p coffee_admin < migration-backup-TIMESTAMP/production-backup-TIMESTAMP.sql
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ:

```bash
# –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
sqlite3 backend/database.sqlite "SELECT name FROM sqlite_master WHERE type='table';" | while read table; do
    echo -n "$table: "
    sqlite3 backend/database.sqlite "SELECT COUNT(*) FROM $table;"
done
```

–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤—ã–≤–æ–¥:

```
users: 3
organizations: 8
orders: 54
engineers: 2
...
```

---

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "sqlite3 not found"

```bash
# macOS
brew install sqlite3

# Linux
sudo apt-get install sqlite3
```

### –û—à–∏–±–∫–∞: "mysql client not found"

```bash
# macOS
brew install mysql

# Linux
sudo apt-get install mysql-client
```

### –û—à–∏–±–∫–∞: "Failed to connect to production database"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å credentials (DB_HOST, DB_PASSWORD –∏ —Ç.–¥.)
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ (ping 192.144.12.102)
3. –û—Ç–∫—Ä—ã—Ç –ª–∏ –ø–æ—Ä—Ç 3306 –Ω–∞ firewall
4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –ø—Ä–∞–≤–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL

### –û—à–∏–±–∫–∞: "Access denied for user"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞:

```sql
GRANT ALL PRIVILEGES ON coffee_admin.* TO 'coffee_user'@'%';
FLUSH PRIVILEGES;
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: "Table already exists"

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—É—Å—Ç–∞—è. –í–∞—Ä–∏–∞–Ω—Ç—ã:

1. –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–û–ü–ê–°–ù–û!)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ (—Å–º. "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã")

---

## üìä –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ production –ë–î
mysql -h 192.144.12.102 -u coffee_user -p coffee_admin

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT 'users' as table_name, COUNT(*) as count FROM users
UNION ALL
SELECT 'orders', COUNT(*) FROM orders
UNION ALL
SELECT 'organizations', COUNT(*) FROM organizations;
```

---

## üÜò –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –ú–µ—Ç–æ–¥ 1: –†—É—á–Ω–æ–π SQL dump

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç SQLite
sqlite3 backend/database.sqlite .dump > local_dump.sql

# 2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ sed)
# –°–º. —Ä–∞–∑–¥–µ–ª "–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞" –≤ —Å–∫—Ä–∏–ø—Ç–µ

# 3. –ò–º–ø–æ—Ä—Ç –≤ MySQL
mysql -h 192.144.12.102 -u coffee_user -p coffee_admin < local_dump.sql
```

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π MySQL dump

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –¥–∞–º–ø –∏–∑ SQLite
sqlite3 backend/database.sqlite .dump > dump.sql

# 2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ MySQL —Ñ–æ—Ä–º–∞—Ç
python3 convert_sqlite_to_mysql.py dump.sql mysql_dump.sql

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ production
mysql -h 192.144.12.102 -u coffee_user -p coffee_admin < mysql_dump.sql
```

### –ú–µ—Ç–æ–¥ 3: –ß–µ—Ä–µ–∑ TypeORM CLI (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

```bash
cd backend
npm run migration:run
```

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

- [ ] SQLite3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] MySQL client —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] Production –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è production (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- [ ] –ü–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ production –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏–∑ backup

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backup - —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `migration-backup-*/`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ MySQL

---

**–£–¥–∞—á–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏!** üöÄ
