# üîç –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üì° –û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç

### `GET /api/app/version`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**URL:** `http://192.144.12.102:3001/api/app/version`

**–ú–µ—Ç–æ–¥:** `GET`

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:** –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)

**–û—Ç–≤–µ—Ç:**
```json
{
  "version": "1.0.2",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
}
```

**–ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:**
- `version` (string) - –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `downloadUrl` (string) - URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è APK
- `required` (boolean) - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (true = –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å)
- `releaseNotes` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ó–∞–º–µ—Ç–∫–∏ –æ —Ä–µ–ª–∏–∑–µ

---

## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤–µ—Ä—Å–∏–∏ 1.0.1

### –®–∞–≥ 1: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
AppComponent.ngOnInit()
  ‚Üì
StartupService.checkForUpdates()
  ‚Üì
AppUpdateService.checkForUpdates()
```

### –®–∞–≥ 2: HTTP –∑–∞–ø—Ä–æ—Å

```typescript
// –ö–æ–¥ –≤ AppUpdateService
const response = await http.get('http://192.144.12.102:3001/api/app/version');
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
```
GET http://192.144.12.102:3001/api/app/version
Headers:
  Accept: application/json
```

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

```json
{
  "version": "1.0.2",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
}
```

### –®–∞–≥ 4: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

```typescript
// –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: 1.0.1 (–∏–∑ build.gradle)
const currentVersion = "1.0.1"; // –ò–∑ App.getInfo()
const serverVersion = response.version; // "1.0.2"

if (serverVersion !== currentVersion) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

### –®–∞–≥ 5: –ü–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞ (–µ—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è"
- –í–µ—Ä—Å–∏—è: "1.0.2"
- –ö–Ω–æ–ø–∫–∏: "–û–±–Ω–æ–≤–∏—Ç—å" / "–û—Ç–º–µ–Ω–∞"

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

### –ß–µ—Ä–µ–∑ curl:

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
curl http://192.144.12.102:3001/api/app/version

# –° —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º JSON
curl -s http://192.144.12.102:3001/api/app/version | jq '.'

# –¢–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏—é
curl -s http://192.144.12.102:3001/api/app/version | jq '.version'
```

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:

```bash
./test-version-endpoint.sh
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```json
{
  "version": "1.0.2",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
}
```

---

## üìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–µ—Ä—Å–∏—è 1.0.1

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
   ```typescript
   if (!Capacitor.isNativePlatform()) {
     // –í–µ–±-–≤–µ—Ä—Å–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞
     return null;
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (24 —á–∞—Å–∞):**
   ```typescript
   const lastCheck = localStorage.getItem('app_update_last_check');
   if (lastCheck && now - lastCheck < 24h) {
     // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
     return null;
   }
   ```

3. **HTTP –∑–∞–ø—Ä–æ—Å:**
   ```typescript
   GET http://192.144.12.102:3001/api/app/version
   ```

4. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π:**
   ```typescript
   currentVersion = "1.0.1"  // –ò–∑ AndroidManifest.xml
   serverVersion = "1.0.2"   // –ò–∑ –æ—Ç–≤–µ—Ç–∞ API
   
   if (serverVersion !== currentVersion) {
     // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥
   }
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ downloadUrl:**
   ```typescript
   if (!response.downloadUrl || response.downloadUrl.trim() === '') {
     // –û—à–∏–±–∫–∞ - URL –ø—É—Å—Ç–æ–π
     return null;
   }
   ```

---

## üîß –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ:

```
üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...
üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: android
üåê –ù–∞—Ç–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: true
üì± –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.1
üåê API URL: http://192.144.12.102:3001/api
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.1
üåê –ó–∞–ø—Ä–æ—Å –∫: http://192.144.12.102:3001/api/app/version
üì° –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {version: "1.0.2", ...}
‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: 1.0.2
üì• URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: http://192.144.12.102:3001/app-debug.apk
‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: false
üì¢ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 1.0.2
```

### –ï—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç:

```
üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...
üì± –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.2
üì° –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {version: "1.0.2", ...}
‚ÑπÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è
```

### –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–∞–≤–Ω—è—è:

```
‚è∞ –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ 2 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º.
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –≠–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl -v http://192.144.12.102:3001/api/app/version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend
ssh user1@192.144.12.102 "docker logs coffee_backend_fallback | tail -20"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
cat backend/src/modules/app/app.controller.ts

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
ssh user1@192.144.12.102 "docker logs coffee_backend_fallback | grep 'app/version'"
```

### –ü—Ä–æ–±–ª–µ–º–∞: downloadUrl –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å APK –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user1@192.144.12.102 "ls -lh ~/coffe/app-debug.apk"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ HTTP
curl -I http://192.144.12.102:3001/app-debug.apk
```

---

## üìù –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞

### –ó–∞–ø—Ä–æ—Å:
```http
GET /api/app/version HTTP/1.1
Host: 192.144.12.102:3001
Accept: application/json
User-Agent: Coffee-Admin/1.0.1 (Android)
```

### –û—Ç–≤–µ—Ç:
```http
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 145

{
  "version": "1.0.2",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
}
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/app/version` –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
- [ ] –ü–æ–ª–µ `version` —Å–æ–¥–µ—Ä–∂–∏—Ç "1.0.2"
- [ ] –ü–æ–ª–µ `downloadUrl` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–±–æ—á–∏–π URL
- [ ] URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è APK –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP 200)
- [ ] –í–µ—Ä—Å–∏—è –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤–µ—Ä—Å–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (1.0.1)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç
./test-version-endpoint.sh

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é 1.0.1 –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä
./install-v1-on-emulator.sh

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
./test-update.sh
```

