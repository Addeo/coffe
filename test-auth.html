<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth Status</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .data-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîê Coffee Admin - Auth Status Test</h1>

    <div id="authStatus" class="status"></div>
    <div id="localStorageData" class="data-section"></div>
    <div id="navigationStatus" class="status"></div>

    <h2>Actions:</h2>
    <button onclick="checkStatus()">üîÑ Check Status</button>
    <button onclick="clearStorage()">üóëÔ∏è Clear LocalStorage</button>
    <button onclick="openApp()">üåê Open Coffee Admin</button>
    <button onclick="openAppInNewTab()">üì± Open in New Tab</button>

    <script>
        function checkStatus() {
            console.log('üîç Checking auth status...');

            // Check localStorage
            const token = localStorage.getItem('access_token');
            const user = localStorage.getItem('user');

            const authDiv = document.getElementById('authStatus');
            const dataDiv = document.getElementById('localStorageData');
            const navDiv = document.getElementById('navigationStatus');

            let authStatus = '‚ùå Not Authenticated';
            let authClass = 'error';

            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    authStatus = `‚úÖ Authenticated as ${userData.firstName} ${userData.lastName} (${userData.role})`;
                    authClass = 'success';
                } catch (e) {
                    authStatus = '‚ùå Invalid user data in localStorage';
                    authClass = 'error';
                }
            } else {
                authStatus = '‚ùå No authentication data found';
                authClass = 'error';
            }

            authDiv.className = `status ${authClass}`;
            authDiv.textContent = authStatus;

            // Show localStorage data
            dataDiv.innerHTML = `
                <h3>LocalStorage Data:</h3>
                <strong>access_token:</strong> ${token ? 'Present (' + token.length + ' chars)' : 'NOT SET'}<br>
                <strong>user:</strong> ${user ? '<pre>' + JSON.stringify(JSON.parse(user), null, 2) + '</pre>' : 'NOT SET'}
            `;

            // Check navigation logic
            const isAuth = !!(token && user);
            const isLoginRoute = window.location.pathname === '/login';
            const shouldShowNav = isAuth && !isLoginRoute;

            navDiv.className = `status ${shouldShowNav ? 'success' : 'warning'}`;
            navDiv.innerHTML = `
                <strong>Navigation Logic:</strong><br>
                Is Authenticated: ${isAuth}<br>
                Is Login Route: ${isLoginRoute}<br>
                Should Show Navigation: ${shouldShowNav}
            `;
        }

        function clearStorage() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user');
            console.log('üóëÔ∏è Cleared localStorage');
            checkStatus();
        }

        function openApp() {
            window.location.href = 'http://localhost:4202';
        }

        function openAppInNewTab() {
            window.open('http://localhost:4202', '_blank');
        }

        // Auto check on load
        checkStatus();
    </script>
</body>
</html>
