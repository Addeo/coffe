# –†–µ–∑—é–º–µ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ - 21 –æ–∫—Ç—è–±—Ä—è 2025

## ‚úÖ –°–ò–°–¢–ï–ú–ê –ò–ï–†–ê–†–•–ò–ß–ï–°–ö–ò–• –†–û–õ–ï–ô

### Backend

1. **User Entity** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
   - `primaryRole` - —Å—Ç–∞—Ä—à–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `activeRole` - —Ç–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Ä–æ–ª—å –≤ —Å–µ—Å—Å–∏–∏
2. **Auth API** - –Ω–æ–≤—ã–µ endpoints:
   - `POST /auth/switch-role` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–æ–ª–∏
   - `POST /auth/reset-role` - —Å–±—Ä–æ—Å –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ–ª–∏
3. **RolesGuard** - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è:
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ activeRole —Å —É—á–µ—Ç–æ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–ª–∞–¥—à–∏–º —Ä–æ–ª—è–º
   - –ò–µ—Ä–∞—Ä—Ö–∏—è: ADMIN (3) > MANAGER (2) > USER (1)

4. **–ú–∏–≥—Ä–∞—Ü–∏—è**: `004_add_role_hierarchy_fields.sql`

### Frontend

1. **AuthService** –æ–±–Ω–æ–≤–ª–µ–Ω:
   - Computed signals: `primaryRole()`, `activeRole()`, `availableRoles()`, `canSwitchRoles()`
   - –ú–µ—Ç–æ–¥—ã: `switchRole()`, `resetRole()`, `hasAccessToRole()`
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Ä–æ–ª–µ–π

2. **Navigation Component** - –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–æ–ª–µ–π:
   - –í dropdown –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (desktop)
   - –í –º–æ–±–∏–ª—å–Ω–æ–º –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é
   - –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–æ–ª–∏
   - Smooth UX —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º reload –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

3. **Shared Interfaces** - —Ñ—É–Ω–∫—Ü–∏–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏:
   - `getAvailableRoles()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–æ–ª–µ–π
   - `hasRoleAccess()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
   - `ROLE_HIERARCHY` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å —É—Ä–æ–≤–Ω—è–º–∏

## ‚úÖ –°–ò–°–¢–ï–ú–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ó–ê–Ø–í–û–ö

### Backend

1. **Order Entity** - –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

   ```typescript
   workActNumber: string; // –ù–æ–º–µ—Ä –ê–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
   workStartTime: Date; // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç
   workEndTime: Date; // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç
   totalWorkHours: number; // –û–±—â–µ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
   isOvertimeRate: boolean; // –í–Ω–µ—É—Ä–æ—á–Ω—ã–π —Ç–∞—Ä–∏—Ñ
   isRepairComplete: boolean; // –†–µ–º–æ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω (–≥–∞–ª–æ—á–∫–∞/–∫—Ä–µ—Å—Ç–∏–∫)
   equipmentInfo: string; // –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä
   comments: string; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   isIncomplete: boolean; // –û—Ç–º–µ—Ç–∫–∞ "!" –¥–ª—è –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
   completionLockedAt: Date; // –î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (24—á)
   ```

2. **–ú–∏–≥—Ä–∞—Ü–∏—è**: `005_add_order_work_execution_fields.sql`

### Frontend

1. **Order Edit Component** - –¥–æ–±–∞–≤–ª–µ–Ω—ã:
   - `workExecutionForm` - —Ñ–æ—Ä–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - Computed signals –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI:
     - `showWorkExecutionForm()` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
     - `isOrderLocked()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
     - `canConfirmOrder()` - –∫–Ω–æ–ø–∫–∞ "–ü–û–î–¢–í–ï–†–î–ò–¢–¨"
     - `canStartExecution()` - –∫–Ω–æ–ø–∫–∞ "–í–´–ü–û–õ–ù–ò–¢–¨"
     - `canCompleteExecution()` - –∫–Ω–æ–ø–∫–∞ "–ó–ê–í–ï–†–®–ò–¢–¨"
     - `totalWorkHours()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏

2. **–ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏**:
   - `onConfirmOrder()` - –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ ASSIGNED –≤ WORKING
   - `onStartExecution()` - –Ω–∞—á–∞–ª–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - `onSetRepairComplete(true/false)` - –≥–∞–ª–æ—á–∫–∞/–∫—Ä–µ—Å—Ç–∏–∫
   - `onCompleteExecution()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏

3. **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**:
   - **–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞** (ASSIGNED): –∫–Ω–æ–ø–∫–∞ "–ü–û–î–¢–í–ï–†–î–ò–¢–¨" ‚Üí WORKING
   - **–í —Ä–∞–±–æ—Ç–µ** (WORKING):
     - –ë–µ–∑ –¥–∞–Ω–Ω—ã—Ö: –∫–Ω–æ–ø–∫–∞ "–í–´–ü–û–õ–ù–ò–¢–¨" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞
     - –° –¥–∞–Ω–Ω—ã–º–∏: —Ñ–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è + –∫–Ω–æ–ø–∫–∞ "–ó–ê–í–ï–†–®–ò–¢–¨"
   - **–í—ã–ø–æ–ª–Ω–µ–Ω–∞** (COMPLETED):
     - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ 24 —á–∞—Å–∞
     - –ü–æ—Å–ª–µ - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä

4. **Shared DTOs** –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏

## ‚úÖ –£–î–ê–õ–ï–ù–ò–ï –¢–ò–ü–ê –ò–ù–ñ–ï–ù–ï–†–ê "–£–î–ê–õ–ï–ù–ù–´–ô"

–£–¥–∞–ª–µ–Ω —Ç–∏–ø `EngineerType.REMOTE` –∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤:

### –û–±–Ω–æ–≤–ª–µ–Ω—ã Enums:

- `/shared/interfaces/order.interface.ts`
- `/backend/shared/interfaces/order.interface.ts`
- `/backend/src/shared/interfaces/order.interface.ts`
- `/backend/src/interfaces/order.interface.ts`
- `/frontend/shared/interfaces/order.interface.ts`

### –û–±–Ω–æ–≤–ª–µ–Ω—ã UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- `/frontend/src/app/pages/users/users.component.ts`
- `/frontend/src/app/pages/user-edit/user-edit.component.ts`
- `/frontend/src/app/components/modals/user-dialog.component.ts`

### –û–±–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:

- `/backend/src/modules/—Ä–∞—Å—á–µ—Ç—ã/calculation.service.ts`
  - –£–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤
  - –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π
  - –£–±—Ä–∞–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è REMOTE

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ:

- **STAFF** (—à—Ç–∞—Ç–Ω—ã–π) - —Å –ø–ª–∞–Ω–æ–º —á–∞—Å–æ–≤, –¥–æ–º–∞—à–Ω–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–µ–π
- **CONTRACT** (–Ω–∞–µ–º–Ω—ã–π/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π) - –±–µ–∑ –ø–ª–∞–Ω–∞ —á–∞—Å–æ–≤, –æ–ø–ª–∞—Ç–∞ –ø–æ –∫–º

## üì± –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø

–í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–æ–ª–µ–π –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
- Touch-friendly –∫–Ω–æ–ø–∫–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—ã
- Responsive layout –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–æ–≤

## üöÄ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

### –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î:

```bash
# Backend migrations
cd backend/migrations
./run-migration.sh 004_add_role_hierarchy_fields.sql
./run-migration.sh 005_add_order_work_execution_fields.sql
```

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∏–Ω–∂–µ–Ω–µ—Ä–æ–º
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

## üéØ –û–°–ù–û–í–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

**–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π:**

- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –º–ª–∞–¥—à–∏–º —Ä–æ–ª—è–º
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ UI
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–æ–ª–∏ –≤ —Å–µ—Å—Å–∏–∏

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫:**

- ‚úÖ –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ (–ù–æ–≤–∞—è ‚Üí –í —Ä–∞–±–æ—Ç–µ ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∞)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- ‚úÖ –û—Ç–º–µ—Ç–∫–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç

**–¢–∏–ø—ã –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤:**

- ‚úÖ –£–¥–∞–ª–µ–Ω REMOTE (—É–¥–∞–ª–µ–Ω–Ω—ã–π)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω—ã STAFF (—à—Ç–∞—Ç–Ω—ã–π) –∏ CONTRACT (–Ω–∞–µ–º–Ω—ã–π)
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

- TypeScript —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤–µ–∑–¥–µ
- Angular Signals –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- Computed values –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ frontend –∏ backend
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å rollback
- Mobile-first –ø–æ–¥—Ö–æ–¥ –∫ UI
