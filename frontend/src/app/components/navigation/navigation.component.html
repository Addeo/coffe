<mat-toolbar color="primary" class="navbar">
  <div class="navbar-content">
    <!-- Mobile Menu Button -->
    <button
      mat-icon-button
      class="mobile-menu-button"
      *ngIf="isAuthenticated()"
      (click)="toggleMobileMenu()"
      aria-label="Toggle mobile menu"
    >
      <mat-icon>{{ isMobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>

    <!-- Logo/Brand -->
    <div class="brand">
      <mat-icon class="brand-icon">local_cafe</mat-icon>
      <span class="brand-text" i18n="@@navigation.brand">Coffee Admin</span>
    </div>

    <!-- Navigation Links -->
    <nav class="nav-links" *ngIf="isAuthenticated()">
      <a
        mat-button
        *ngFor="let item of navigationItems()"
        [routerLink]="item.route"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }"
      >
        <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
        <span [attr.i18n]="item.i18nKey">{{ item.label }}</span>
      </a>
    </nav>

    <!-- Desktop Logout Button -->
    <div class="desktop-logout" *ngIf="isAuthenticated()">
      <button mat-icon-button (click)="logout()" matTooltip="Logout" aria-label="Logout">
        <mat-icon>logout</mat-icon>
      </button>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-menu-overlay" *ngIf="isMobileMenuOpen()" (click)="closeMobileMenu()">
      <div class="mobile-menu-content" (click)="$event.stopPropagation()">
        <div class="mobile-menu-header">
          <div class="brand">
            <mat-icon class="brand-icon">local_cafe</mat-icon>
            <span class="brand-text mobile-brand-text" i18n="@@navigation.brand">Coffee Admin</span>
          </div>
          <button mat-icon-button (click)="closeMobileMenu()" aria-label="Close menu">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <nav class="mobile-nav-links">
          <a
            mat-button
            *ngFor="let item of navigationItems()"
            [routerLink]="item.route"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: false }"
            (click)="closeMobileMenu()"
          >
            <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
            <span [attr.i18n]="item.i18nKey">{{ item.label }}</span>
            <span
              *ngIf="item.badge"
              class="mobile-badge"
              matBadge="{{ item.badge }}"
              matBadgeColor="warn"
            ></span>
          </a>
        </nav>

        <div class="mobile-menu-footer">
          <div class="user-info-mobile">
            <div class="user-details">
              <div class="user-full-name">{{ userName() }}</div>
              <div class="user-role-mobile">
                <mat-icon class="role-icon">{{ getRoleIcon(activeRole()!) }}</mat-icon>
                <span>{{ getRoleDisplayName(activeRole()!) }}</span>
                @if (canSwitchRoles()) {
                  <mat-icon class="switch-icon">sync_alt</mat-icon>
                }
              </div>
              <div class="user-email">{{ currentUser()?.email }}</div>
            </div>
          </div>
          
          <!-- Role Switcher for Mobile -->
          @if (canSwitchRoles()) {
            <div class="role-switcher-mobile">
              <div class="section-title">
                <span i18n="@@navigation.switchRole">Переключить роль</span>
              </div>
              @for (role of availableRoles(); track role) {
                <button 
                  mat-button
                  class="role-option"
                  (click)="switchRole(role)"
                  [disabled]="isRoleActive(role) || isLoadingRoleSwitch()"
                  [class.active-role]="isRoleActive(role)">
                  <mat-icon>{{ getRoleIcon(role) }}</mat-icon>
                  <span>{{ getRoleDisplayName(role) }}</span>
                  @if (isRoleActive(role)) {
                    <mat-icon class="check-icon">check</mat-icon>
                  }
                </button>
              }
            </div>
          }
          
          <div class="mobile-actions">
            <button mat-stroked-button (click)="toggleTheme()" class="theme-toggle-mobile">
              <mat-icon>{{ themeIcon() }}</mat-icon>
              <span>{{ currentTheme() === 'dark' ? 'Светлая тема' : 'Темная тема' }}</span>
            </button>
            <button mat-stroked-button (click)="logout()" class="logout-mobile">
              <mat-icon>logout</mat-icon>
              <span i18n="@@navigation.logout">Выход</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Section -->
    <div class="right-section" *ngIf="isAuthenticated()">
      <!-- Theme Toggle -->
      <!-- <button
        mat-icon-button
        (click)="toggleTheme()"
        [matTooltip]="getThemeTooltip()"
        class="theme-toggle-button"
        aria-label="Toggle theme"
      >
        <mat-icon>{{ themeIcon() }}</mat-icon>
      </button> -->

      <!-- Notifications -->
      <div class="notifications-menu">
        <button
          mat-icon-button
          [matMenuTriggerFor]="notificationsMenu"
          class="notifications-button"
        >
          <mat-icon class="notifications-icon">notifications</mat-icon>
          <span
            class="notifications-badge"
            *ngIf="unreadCount() > 0"
            matBadge="{{ unreadCount() }}"
            matBadgeColor="warn"
          ></span>
        </button>

        <mat-menu #notificationsMenu="matMenu" class="notifications-dropdown">
          <div class="notifications-header" mat-menu-item disabled>
            <h4 i18n="@@navigation.notifications">Уведомления</h4>
            <button
              mat-button
              *ngIf="unreadCount() > 0"
              (click)="onMarkAllAsRead()"
              i18n="@@notifications.markAllAsRead"
            >
              Отметить все как прочитанные
            </button>
          </div>

          <mat-divider></mat-divider>

          <div *ngIf="recentNotifications().length === 0" mat-menu-item disabled>
            <mat-icon>notifications_none</mat-icon>
            <span i18n="@@notifications.noNewNotifications">Нет новых уведомлений</span>
          </div>

          <div
            *ngFor="let notification of recentNotifications()"
            mat-menu-item
            [class.unread]="notification.status === 'unread'"
            (click)="onNotificationClick(notification)"
          >
            <div class="notification-item">
              <mat-icon [style.color]="getPriorityColor(notification.priority)">
                {{ getPriorityIcon(notification.priority) }}
              </mat-icon>
              <div class="notification-content">
                <div class="notification-title">{{ notification.title }}</div>
                <div class="notification-message">{{ notification.message }}</div>
                <div class="notification-time">{{ notification.createdAt | date: 'short' }}</div>
              </div>
              <mat-icon *ngIf="notification.status === 'unread'" class="unread-indicator"
                >fiber_manual_record</mat-icon
              >
            </div>
          </div>

          <mat-divider *ngIf="recentNotifications().length > 0"></mat-divider>

          <button mat-menu-item (click)="onViewAllNotifications()">
            <mat-icon>visibility</mat-icon>
            <span i18n="@@notifications.viewAllNotifications">Показать все уведомления</span>
          </button>
        </mat-menu>
      </div>

      <!-- User Menu -->
      <div class="user-menu">
        <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
          <mat-icon class="user-icon">account_circle</mat-icon>
          <span class="user-name">{{ userName() }}</span>
          <mat-icon class="dropdown-icon">expand_more</mat-icon>
        </button>

        <mat-menu #userMenu="matMenu" class="user-dropdown">
          <!-- Test with regular buttons -->
          <button (click)="navigateToProfile()" style="width: 100%; text-align: left; padding: 12px 16px; border: none; background: none; cursor: pointer;">
            <mat-icon>person</mat-icon>
            <span>Мой профиль</span>
          </button>

          <button (click)="logout()" style="width: 100%; text-align: left; padding: 12px 16px; border: none; background: none; cursor: pointer;">
            <mat-icon>logout</mat-icon>
            <span>Выход</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>
</mat-toolbar>
