<!-- Desktop Navigation -->
@if (!isMobileView()) {
  <ng-container *ngTemplateOutlet="desktopTemplate"></ng-container>
}

<!-- Mobile Navigation -->
@if (isMobileView()) {
  <ng-container *ngTemplateOutlet="mobileTemplate"></ng-container>
}

<!-- Desktop Template -->
<ng-template #desktopTemplate>
  <ng-container *ngTemplateOutlet="desktopContent"></ng-container>
</ng-template>

<!-- Mobile Template -->
<ng-template #mobileTemplate>
  <ng-container *ngTemplateOutlet="mobileContent"></ng-container>
</ng-template>

<!-- Desktop Content -->
<ng-template #desktopContent>
  <mat-toolbar color="primary" class="navbar">
    <div class="navbar-content">
      <!-- Logo/Brand -->
      <div class="brand">
        <mat-icon class="brand-icon">local_cafe</mat-icon>
        <span class="brand-text" i18n="@@navigation.brand">Админка Кофе</span>
      </div>

      <!-- Navigation Links -->
      <nav class="nav-links" *ngIf="isAuthenticated()">
        <a
          mat-button
          *ngFor="let item of navigationItems()"
          [routerLink]="item.route"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: false }"
        >
          <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
          <span [attr.i18n]="item.i18nKey">{{ item.label }}</span>
          <span class="nav-badge" *ngIf="item.badge && item.badge > 0">{{ item.badge }}</span>
        </a>
      </nav>

      <!-- Right Section -->
      <div class="right-section" *ngIf="isAuthenticated()">
        <!-- Notifications -->
        <div class="notifications-menu">
          <button
            mat-icon-button
            (click)="onViewAllNotifications()"
            class="notifications-button"
            matTooltip="Перейти к уведомлениям"
            aria-label="Уведомления"
          >
            <mat-icon class="notifications-icon">notifications</mat-icon>
            <span
              class="notifications-badge"
              *ngIf="unreadCount() > 0"
              matBadge="{{ unreadCount() }}"
              matBadgeColor="warn"
            ></span>
          </button>
        </div>

        <!-- User Menu -->
        <div class="user-menu">
          <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
            <mat-icon class="user-icon">account_circle</mat-icon>
            <span class="user-name">{{ userName() }}</span>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>

          <mat-menu #userMenu="matMenu" class="user-dropdown">
            <!-- Current Role Display -->
            <div class="user-menu-role-display">
              <div class="user-menu-role-label">Текущая роль</div>
              <div class="user-menu-role-value">
                <mat-icon>{{ getRoleIcon(activeRole()!) }}</mat-icon>
                <span>{{ getRoleDisplayName(activeRole()!) }}</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Role Switcher -->
            @if (canSwitchRoles()) {
              <div class="role-switcher-section">
                <div class="section-title">
                  <span>Переключить роль</span>
                </div>
                <div class="role-switcher-grid">
                  @for (role of availableRoles(); track role) {
                    <button
                      class="role-switcher-button"
                      (click)="!isRoleActive(role) && !isLoadingRoleSwitch() && switchRole(role)"
                      [disabled]="isRoleActive(role) || isLoadingRoleSwitch()"
                      [class.active-role]="isRoleActive(role)"
                    >
                      <mat-icon>{{ getRoleIcon(role) }}</mat-icon>
                      <span>{{ getRoleDisplayName(role) }}</span>
                      @if (isRoleActive(role)) {
                        <mat-icon class="check-icon">check</mat-icon>
                      }
                      @if (isLoadingRoleSwitch() && !isRoleActive(role)) {
                        <mat-icon class="loading-icon">sync</mat-icon>
                      }
                    </button>
                  }
                </div>
              </div>
              <mat-divider></mat-divider>
            }

            <!-- Profile and Logout buttons -->
            <div class="user-menu-actions">
              <button class="user-menu-button" (click)="navigateToProfile()">
                <mat-icon>person</mat-icon>
                <span>Мой профиль</span>
              </button>

              <button class="user-menu-button user-menu-button-logout" (click)="logout()">
                <mat-icon>logout</mat-icon>
                <span>Выход</span>
              </button>
            </div>
          </mat-menu>
        </div>
      </div>
    </div>
  </mat-toolbar>
</ng-template>

<!-- Mobile Content -->
<ng-template #mobileContent>
  <mat-toolbar color="primary" class="navbar mobile-navbar" *ngIf="isAuthenticated()">
    <div class="mobile-navbar-content">
      <!-- Home Button (Coffee Icon) -->
      <button
        mat-icon-button
        class="mobile-nav-button"
        [routerLink]="homeRoute()"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }"
        aria-label="Главная страница"
      >
        <mat-icon>local_cafe</mat-icon>
      </button>

      <!-- Documents Button -->
      <button
        mat-icon-button
        class="mobile-nav-button"
        [routerLink]="['/documents']"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }"
        aria-label="Документы"
      >
        <mat-icon>description</mat-icon>
      </button>

      <!-- Notifications Button -->
      <button
        mat-icon-button
        class="mobile-nav-button"
        (click)="onViewAllNotifications()"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }"
        aria-label="Уведомления"
      >
        <mat-icon>notifications</mat-icon>
        <span class="mobile-badge" *ngIf="unreadCount() > 0">{{ unreadCount() }}</span>
      </button>

      <!-- User Menu Button -->
      <button
        mat-icon-button
        class="mobile-nav-button"
        [matMenuTriggerFor]="mobileUserMenu"
        aria-label="Профиль пользователя"
      >
        <mat-icon>account_circle</mat-icon>
      </button>
    </div>

    <!-- Role Indicator for Admin (shown below navigation buttons in header) -->
    @if (primaryRole() === UserRole.ADMIN && canSwitchRoles() && !isRoleIndicatorHidden()) {
      <div class="mobile-role-indicator">
        <div class="role-indicator-content">
          <mat-icon class="role-indicator-icon">{{ getRoleIcon(activeRole()!) }}</mat-icon>
          <span class="role-indicator-text">{{ getRoleDisplayName(activeRole()!) }}</span>
        </div>
        <button
          mat-icon-button
          class="role-indicator-close"
          (click)="hideRoleIndicator()"
          aria-label="Скрыть индикатор роли"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
    }
  </mat-toolbar>

  <!-- Mobile User Menu -->
  <mat-menu #mobileUserMenu="matMenu" class="mobile-user-menu">
    <!-- User Info -->
    <div class="mobile-user-info">
      <div class="user-full-name">{{ userName() }}</div>
      <div class="user-role-mobile">
        <mat-icon class="role-icon">{{ getRoleIcon(activeRole()!) }}</mat-icon>
        <span>{{ getRoleDisplayName(activeRole()!) }}</span>
      </div>
      <div class="user-email">{{ currentUser()?.email }}</div>
    </div>

    <mat-divider></mat-divider>

    <!-- Role Switcher -->
    @if (canSwitchRoles()) {
      <div class="role-switcher-mobile-menu">
        <div class="section-title">Переключить роль</div>
        @for (role of availableRoles(); track role) {
          <button
            mat-menu-item
            (click)="switchRole(role)"
            [disabled]="isRoleActive(role) || isLoadingRoleSwitch()"
            [class.active-role]="isRoleActive(role)"
          >
            <mat-icon>{{ getRoleIcon(role) }}</mat-icon>
            <span>{{ getRoleDisplayName(role) }}</span>
            @if (isRoleActive(role)) {
              <mat-icon class="check-icon">check</mat-icon>
            }
          </button>
        }
      </div>
      <mat-divider></mat-divider>
    }

    <!-- Actions -->
    <button mat-menu-item (click)="navigateToProfile()">
      <mat-icon>person</mat-icon>
      <span>Мой профиль</span>
    </button>

    <!-- <button mat-menu-item (click)="toggleTheme()">
          <mat-icon>{{ themeIcon() }}</mat-icon>
          <span>{{ currentTheme() === 'dark' ? 'Светлая тема' : 'Темная тема' }}</span>
        </button> -->

    <mat-divider></mat-divider>

    <button mat-menu-item (click)="logout()" class="logout-menu-item">
      <mat-icon>logout</mat-icon>
      <span>Выход</span>
    </button>
  </mat-menu>
</ng-template>
