<mat-card class="work-session-form">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>add_circle</mat-icon>
      Добавить рабочую сессию (выезд)
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="sessionForm" (ngSubmit)="onSubmit()">
      <!-- Дата работы -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Дата работы</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="workDate"
          placeholder="Выберите дату"
          required
        />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="sessionForm.get('workDate')?.hasError('required')">
          Дата обязательна
        </mat-error>
      </mat-form-field>

      <!-- Часы работы -->
      <div class="hours-row">
        <mat-form-field appearance="outline">
          <mat-label>Обычные часы</mat-label>
          <input
            matInput
            type="number"
            formControlName="regularHours"
            placeholder="0"
            min="0"
            max="24"
            step="0.25"
          />
          <span matTextSuffix>ч</span>
          <mat-error *ngIf="sessionForm.get('regularHours')?.hasError('required')">
            Обязательно
          </mat-error>
          <mat-error *ngIf="sessionForm.get('regularHours')?.hasError('min')">
            Минимум 0
          </mat-error>
          <mat-error *ngIf="sessionForm.get('regularHours')?.hasError('max')">
            Максимум 24
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Переработка</mat-label>
          <input
            matInput
            type="number"
            formControlName="overtimeHours"
            placeholder="0"
            min="0"
            max="24"
            step="0.25"
          />
          <span matTextSuffix>ч</span>
          <mat-error *ngIf="sessionForm.get('overtimeHours')?.hasError('min')">
            Минимум 0
          </mat-error>
          <mat-error *ngIf="sessionForm.get('overtimeHours')?.hasError('max')">
            Максимум 24
          </mat-error>
        </mat-form-field>

        <div class="total-hours">
          <span class="label">Всего:</span>
          <span class="value">{{ totalHours.toFixed(2) }} ч</span>
        </div>
      </div>

      <!-- Оплата за машину -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Оплата за машину</mat-label>
        <input
          matInput
          type="number"
          formControlName="carPayment"
          placeholder="0"
          min="0"
          step="100"
        />
        <span matTextSuffix>₽</span>
        <mat-error *ngIf="sessionForm.get('carPayment')?.hasError('required')">
          Обязательно
        </mat-error>
        <mat-error *ngIf="sessionForm.get('carPayment')?.hasError('min')">
          Минимум 0
        </mat-error>
      </mat-form-field>

      <!-- Расстояние -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Расстояние (опционально)</mat-label>
        <input
          matInput
          type="number"
          formControlName="distanceKm"
          placeholder="0"
          min="0"
          step="0.1"
        />
        <span matTextSuffix>км</span>
        <mat-error *ngIf="sessionForm.get('distanceKm')?.hasError('min')">
          Минимум 0
        </mat-error>
      </mat-form-field>

      <!-- Тип территории -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Тип территории (опционально)</mat-label>
        <input
          matInput
          formControlName="territoryType"
          placeholder="Например: home, zone_1"
        />
      </mat-form-field>

      <!-- Примечания -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Примечания</mat-label>
        <textarea
          matInput
          formControlName="notes"
          placeholder="Описание выполненной работы"
          rows="4"
        ></textarea>
      </mat-form-field>

      <!-- Можно ли выставить счёт -->
      <div class="checkbox-row">
        <mat-checkbox formControlName="canBeInvoiced">
          Оплачиваемая сессия (учитывать в расчёте зарплаты)
        </mat-checkbox>
      </div>

      <!-- Ошибка -->
      <div *ngIf="error" class="error-message">
        <mat-icon>error</mat-icon>
        {{ error }}
      </div>
    </form>
  </mat-card-content>

  <mat-card-actions>
    <button
      mat-raised-button
      color="primary"
      [disabled]="loading || sessionForm.invalid"
      (click)="onSubmit()"
    >
      <mat-icon>save</mat-icon>
      {{ loading ? 'Сохранение...' : 'Сохранить сессию' }}
    </button>
    <button mat-button type="button" (click)="onCancel()" [disabled]="loading">
      Отмена
    </button>
  </mat-card-actions>
</mat-card>

