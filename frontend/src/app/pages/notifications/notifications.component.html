<div class="notifications-container">
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>notifications</mat-icon>
        <span i18n="@@notifications.title">Уведомления</span>
      </mat-card-title>
      <mat-card-subtitle i18n="@@notifications.subtitle">Просмотр и управление уведомлениями</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="actions-row">
        <div class="stats">
          <mat-chip [color]="'primary'">
            <mat-icon>notifications</mat-icon>
            <span i18n="@@notifications.total">Всего</span>: {{ getTotalCount() }}
          </mat-chip>
          <mat-chip [color]="'warn'">
            <mat-icon>mark_email_unread</mat-icon>
            <span i18n="@@notifications.unread">Непрочитанные</span>: {{ getUnreadCount() }}
          </mat-chip>
          <mat-chip [color]="'accent'">
            <mat-icon>mark_email_read</mat-icon>
            <span i18n="@@notifications.read">Прочитанные</span>: {{ getReadCount() }}
          </mat-chip>
        </div>

        <div class="action-buttons">
          <button mat-raised-button (click)="loadNotifications()" [disabled]="isLoading()">
            <mat-icon>refresh</mat-icon>
            <span i18n="@@notifications.refresh">Обновить</span>
          </button>

          <button
            mat-raised-button
            color="primary"
            (click)="onMarkAllAsRead()"
            [disabled]="getUnreadCount() === 0"
          >
            <mat-icon>mark_email_read</mat-icon>
            <span i18n="@@notifications.markAllAsRead">Отметить все как прочитанные</span>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="table-card">
    <mat-card-content>
      <mat-tab-group (selectedTabChange)="onTabChange($event.index)">
        <mat-tab label="Все уведомления">
          <div class="tab-content">
            <table mat-table [dataSource]="allDataSource" matSort class="notifications-table">
              <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
                <ng-container *ngIf="column === 'type'">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@notifications.type">Тип</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getNotificationТипColor(notification.type)" selected>
                      {{ getNotificationТипDisplay(notification.type) }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'title'">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@notifications.title">Заголовок</th>
                  <td mat-cell *matCellDef="let notification">
                    <div class="title-cell">
                      <strong>{{ notification.title }}</strong>
                      <mat-icon *ngIf="notification.status === 'unread'" class="unread-indicator"
                        >fiber_manual_record</mat-icon
                      >
                    </div>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'message'">
                  <th mat-header-cell *matHeaderCellDef i18n="@@notifications.message">Сообщение</th>
                  <td mat-cell *matCellDef="let notification">
                    <div class="message-cell">
                      {{ notification.message }}
                    </div>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'priority'">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@notifications.priority">Приоритет</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getPriorityColor(notification.priority)" selected>
                      <mat-icon>{{ getPriorityIcon(notification.priority) }}</mat-icon>
                      {{ notification.priority.toUpperCase() }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'createdAt'">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@notifications.created">Создано</th>
                  <td mat-cell *matCellDef="let notification">
                    {{ formatDate(notification.createdAt) }}
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'actions'">
                  <th mat-header-cell *matHeaderCellDef i18n="@@notifications.actions">Действия</th>
                  <td mat-cell *matCellDef="let notification">
                    <button
                      mat-icon-button
                      [matMenuTriggerFor]="menu"
                      aria-label="Notification actions"
                    >
                      <mat-icon>more_vert</mat-icon>
                    </button>

                    <mat-menu #menu="matMenu">
                      <button
                        mat-menu-item
                        *ngIf="notification.status === 'unread'"
                        (click)="onMarkAsRead(notification)"
                      >
                        <mat-icon>mark_email_read</mat-icon>
                        <span i18n="@@notifications.markAsRead">Отметить как прочитанное</span>
                      </button>

                      <button
                        mat-menu-item
                        *ngIf="notification.status === 'read'"
                        (click)="onMarkAsUnread(notification)"
                      >
                        <mat-icon>mark_email_unread</mat-icon>
                        <span i18n="@@notifications.markAsUnread">Отметить как непрочитанное</span>
                      </button>

                      <button mat-menu-item (click)="onDeleteNotification(notification)">
                        <mat-icon>delete</mat-icon>
                        <span i18n="@@notifications.delete">Удалить</span>
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Непрочитанные">
          <div class="tab-content">
            <table mat-table [dataSource]="unreadDataSource" matSort class="notifications-table">
              <!-- Same columns as above -->
              <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
                <ng-container *ngIf="column === 'type'">
                  <th mat-header-cell *matHeaderCellDef>Тип</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getNotificationТипColor(notification.type)" selected>
                      {{ getNotificationТипDisplay(notification.type) }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'title'">
                  <th mat-header-cell *matHeaderCellDef>Заголовок</th>
                  <td mat-cell *matCellDef="let notification">
                    <div class="title-cell">
                      <strong>{{ notification.title }}</strong>
                      <mat-icon class="unread-indicator">fiber_manual_record</mat-icon>
                    </div>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'message'">
                  <th mat-header-cell *matHeaderCellDef>Сообщение</th>
                  <td mat-cell *matCellDef="let notification">
                    <div class="message-cell">
                      {{ notification.message }}
                    </div>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'priority'">
                  <th mat-header-cell *matHeaderCellDef>Priority</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getPriorityColor(notification.priority)" selected>
                      <mat-icon>{{ getPriorityIcon(notification.priority) }}</mat-icon>
                      {{ notification.priority.toUpperCase() }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'createdAt'">
                  <th mat-header-cell *matHeaderCellDef>Created</th>
                  <td mat-cell *matCellDef="let notification">
                    {{ formatDate(notification.createdAt) }}
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'actions'">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let notification">
                    <button
                      mat-icon-button
                      [matMenuTriggerFor]="menu"
                      aria-label="Notification actions"
                    >
                      <mat-icon>more_vert</mat-icon>
                    </button>

                    <mat-menu #menu="matMenu">
                      <button mat-menu-item (click)="onMarkAsRead(notification)">
                        <mat-icon>mark_email_read</mat-icon>
                        <span>Mark as Read</span>
                      </button>

                      <button mat-menu-item (click)="onDeleteNotification(notification)">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Прочитанные">
          <div class="tab-content">
            <table mat-table [dataSource]="readDataSource" matSort class="notifications-table">
              <!-- Same columns as above, but without unread indicator -->
              <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
                <ng-container *ngIf="column === 'type'">
                  <th mat-header-cell *matHeaderCellDef>Тип</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getNotificationТипColor(notification.type)" selected>
                      {{ getNotificationТипDisplay(notification.type) }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'title'">
                  <th mat-header-cell *matHeaderCellDef>Заголовок</th>
                  <td mat-cell *matCellDef="let notification">
                    <strong>{{ notification.title }}</strong>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'message'">
                  <th mat-header-cell *matHeaderCellDef>Сообщение</th>
                  <td mat-cell *matCellDef="let notification">
                    <div class="message-cell">
                      {{ notification.message }}
                    </div>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'priority'">
                  <th mat-header-cell *matHeaderCellDef>Priority</th>
                  <td mat-cell *matCellDef="let notification">
                    <mat-chip [color]="getPriorityColor(notification.priority)" selected>
                      <mat-icon>{{ getPriorityIcon(notification.priority) }}</mat-icon>
                      {{ notification.priority.toUpperCase() }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'createdAt'">
                  <th mat-header-cell *matHeaderCellDef>Created</th>
                  <td mat-cell *matCellDef="let notification">
                    {{ formatDate(notification.createdAt) }}
                  </td>
                </ng-container>

                <ng-container *ngIf="column === 'actions'">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let notification">
                    <button
                      mat-icon-button
                      [matMenuTriggerFor]="menu"
                      aria-label="Notification actions"
                    >
                      <mat-icon>more_vert</mat-icon>
                    </button>

                    <mat-menu #menu="matMenu">
                      <button mat-menu-item (click)="onMarkAsUnread(notification)">
                        <mat-icon>mark_email_unread</mat-icon>
                        <span>Mark as Unread</span>
                      </button>

                      <button mat-menu-item (click)="onDeleteNotification(notification)">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </mat-tab>
      </mat-tab-group>

      <!-- Loading spinner -->
      <div *ngIf="isLoading()" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p i18n="@@notifications.loading">Loading notifications...</p>
      </div>

      <!-- No data message -->
      <div
        *ngIf="!isLoading() && getCurrentDataSource().data.length === 0"
        class="no-data-container"
      >
        <mat-icon class="no-data-icon">notifications_off</mat-icon>
        <h3 i18n="@@notifications.noNotificationsFound">No notifications found</h3>
        <p i18n="@@notifications.noNotificationsInCategory">You don't have any notifications in this category.</p>
      </div>

      <!-- Paginator -->
      <mat-paginator
        *ngIf="getCurrentDataSource().data.length > 0"
        [pageSizeOptions]="[10, 25, 50]"
        showFirstLastButtons
      >
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
