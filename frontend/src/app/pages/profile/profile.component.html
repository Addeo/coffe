<div class="profile-container">
  <div class="header">
    <h1 i18n="@@profile.myProfile">My Profile</h1>
  </div>

  <div class="profile-content">
    <!-- Profile Avatar Section -->
    <mat-card class="avatar-card">
      <mat-card-content>
        <div class="avatar-section">
          <div class="avatar-placeholder">
            <mat-icon>person</mat-icon>
          </div>
          <div class="avatar-info">
            <h3>{{ currentUser()?.firstName }} {{ currentUser()?.lastName }}</h3>
            <p>{{ currentUser()?.email }}</p>
            <button mat-raised-button color="primary" (click)="uploadAvatar()">
              <mat-icon>photo_camera</mat-icon>
              <span i18n="@@profile.changeAvatar">Change Avatar</span>
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Profile Information -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title i18n="@@profile.profileInformation">Profile Information</mat-card-title>
        <mat-card-subtitle i18n="@@profile.updatePersonalInfo">Update your personal information</mat-card-subtitle>
        <div class="card-actions">
          <button mat-icon-button (click)="toggleEditMode()" [disabled]="isLoading()">
            <mat-icon>{{ isEditing() ? 'close' : 'edit' }}</mat-icon>
          </button>
        </div>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label i18n="@@profile.firstName">First Name</mat-label>
              <input matInput formControlName="firstName" [readonly]="!isEditing()" />
              <mat-error
                *ngIf="
                  profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched
                "
                i18n="@@profile.firstNameRequired"
              >
                First name is required and must be at least 2 characters
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label i18n="@@profile.lastName">Last Name</mat-label>
              <input matInput formControlName="lastName" [readonly]="!isEditing()" />
              <mat-error
                *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched"
                i18n="@@profile.lastNameRequired"
              >
                Last name is required and must be at least 2 characters
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label i18n="@@profile.email">Email</mat-label>
            <input matInput formControlName="email" type="email" [readonly]="!isEditing()" />
            <mat-error
              *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
              i18n="@@profile.emailRequired"
            >
              Please enter a valid email address
            </mat-error>
          </mat-form-field>

          <div class="role-info" *ngIf="currentUser()?.role">
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label i18n="@@profile.role">Role</mat-label>
              <input matInput [value]="getRoleDisplay(currentUser()!.role)" readonly />
            </mat-form-field>
          </div>

          <div class="form-actions" *ngIf="isEditing()">
            <button mat-button type="button" (click)="cancelEdit()" [disabled]="isLoading()">
              <span i18n="@@profile.cancel">Cancel</span>
            </button>
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="isLoading() || profileForm.invalid"
            >
              <mat-icon *ngIf="isLoading()">refresh</mat-icon>
              <mat-icon *ngIf="!isLoading()">save</mat-icon>
              {{ isLoading() ? 'Сохранение...' : 'Сохранить изменения' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Security Section -->
    <mat-card class="security-card">
      <mat-card-header>
        <mat-card-title i18n="@@profile.security">Security</mat-card-title>
        <mat-card-subtitle i18n="@@profile.manageSecurity">Manage your account security</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="security-item">
          <div class="security-info">
            <mat-icon>lock</mat-icon>
            <div>
              <h4 i18n="@@profile.password">Password</h4>
              <p i18n="@@profile.lastChanged">Last changed: Recently</p>
            </div>
          </div>
          <button mat-raised-button (click)="changePassword()">
            <span i18n="@@profile.changePassword">Change Password</span>
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
