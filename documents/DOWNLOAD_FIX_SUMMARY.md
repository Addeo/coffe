# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç 4000 –≤–º–µ—Å—Ç–æ 3001, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É 405 Not Allowed.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Frontend - environment.prod.ts

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `authUrl` —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π:

```typescript
// –ë—ã–ª–æ:
authUrl: '/api/auth/login',

// –°—Ç–∞–ª–æ:
authUrl: 'http://192.144.12.102:3001/api/auth/login',
```

### 2. Frontend - auth.service.ts

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ `authUrl` –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π:

- –ï—Å–ª–∏ `authUrl` –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/`, –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL –Ω–∞ –æ—Å–Ω–æ–≤–µ `apiUrl`
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏

### 3. Backend - app.controller.ts

–£–ª—É—á—à–µ–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `downloadUrl`:

- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ URL –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `req.protocol` –∏ `req.get('host')` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è URL

### 4. Backend - main.ts

–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ APK —Ñ–∞–π–ª–∞:

- –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—É—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ñ–∞–π–ª, –∞ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint –≤–µ—Ä—Å–∏–∏:

```bash
curl http://192.144.12.102:3001/api/app/version
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "version": "1.0.8",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "..."
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è APK:

```bash
curl -I http://192.144.12.102:3001/app-debug.apk
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: HTTP 200 OK —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

## –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ APK —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –æ–¥–Ω–æ–º –∏–∑ —ç—Ç–∏—Ö –º–µ—Å—Ç:
   - –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞: `/path/to/project/app-debug.apk`
   - Backend –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `/path/to/project/backend/app-debug.apk`
   - –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è: `APK_PATH=/path/to/app-debug.apk`

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

   ```bash
   # –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ
   pm2 restart backend
   # –∏–ª–∏
   systemctl restart coffee-admin-backend
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
   - `‚úÖ APK file found at: [–ø—É—Ç—å]`
   - `üì¶ APK file size: [—Ä–∞–∑–º–µ—Ä] bytes`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### Frontend - app-update.service.ts

–£–ª—É—á—à–µ–Ω –º–µ—Ç–æ–¥ `downloadAndInstall`:

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ç–æ–¥—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥: `npm run build --configuration production`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ª–æ–≥–∏–Ω–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ –ø–æ—Ä—Ç 3001, –∞ –Ω–µ 4000
