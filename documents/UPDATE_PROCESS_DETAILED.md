# üîÑ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìä –ü–æ–ª–Ω—ã–π flow –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (1.0.1 ‚Üí 1.0.2)

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ 1.0.1
  ‚Üì
AppComponent.ngOnInit()
  ‚Üì
startupService.checkForUpdates()
```

**–ö–æ–¥:**
```typescript
// frontend/src/app/app.component.ts
ngOnInit(): void {
  this.startupService.checkForUpdates();
}
```

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**AppUpdateService.checkForUpdates()** –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

#### 2.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

```typescript
if (!Capacitor.isNativePlatform()) {
  // –í–µ–±-–≤–µ—Ä—Å–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞
  return null;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Android/iOS

#### 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (24 —á–∞—Å–∞)

```typescript
const lastCheck = localStorage.getItem('app_update_last_check');
if (lastCheck && now - lastCheck < 24h) {
  // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
  return null;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (—á—Ç–æ–±—ã –Ω–µ –Ω–∞–¥–æ–µ–¥–∞—Ç—å)

#### 2.3 HTTP –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É

```typescript
const response = await http.get('http://192.144.12.102:3001/api/app/version');
```

**–ó–∞–ø—Ä–æ—Å:**
```http
GET /api/app/version HTTP/1.1
Host: 192.144.12.102:3001
Accept: application/json
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "version": "1.0.2",
  "downloadUrl": "http://192.144.12.102:3001/app-debug.apk",
  "required": false,
  "releaseNotes": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
}
```

#### 2.4 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

```typescript
const currentVersion = "1.0.1";  // –ò–∑ App.getInfo() ‚Üí AndroidManifest.xml
const serverVersion = response.version; // "1.0.2"

if (serverVersion !== currentVersion) {
  // ‚úÖ –í–µ—Ä—Å–∏–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ!
  return response; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `versionInfo`

---

### –®–∞–≥ 3: –ü–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**StartupService.checkForUpdates()** –ø–æ–ª—É—á–∞–µ—Ç `versionInfo` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥:

```typescript
if (versionInfo) {
  console.log('üì¢ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:', versionInfo.version);

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º Material Dialog
  const dialogRef = this.dialog.open(AppUpdateComponent, {
    width: '400px',
    disableClose: versionInfo.required, // –ï—Å–ª–∏ required=true, –Ω–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å
    data: versionInfo, // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏–∞–ª–æ–≥
  });
}
```

---

### –®–∞–≥ 4: –î–∏–∞–ª–æ–≥ AppUpdateComponent

**–í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üîÑ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è 1.0.2     ‚îÇ
‚îÇ  –¥–æ—Å—Ç—É–ø–Ω–∞.                          ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –ß—Ç–æ –Ω–æ–≤–æ–≥–æ:                        ‚îÇ
‚îÇ  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏  ‚îÇ
‚îÇ  –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫.              ‚îÇ
‚îÇ                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ          [–ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ]  [–û–±–Ω–æ–≤–∏—Ç—å] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**HTML —à–∞–±–ª–æ–Ω:**
```html
<mat-card>
  <mat-card-header>
    <mat-card-title>
      <mat-icon>system_update_alt</mat-icon>
      –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>
      –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è <strong>{{ data.version }}</strong> –¥–æ—Å—Ç—É–ø–Ω–∞.
    </p>
    <div *ngIf="data.releaseNotes">
      <h4>–ß—Ç–æ –Ω–æ–≤–æ–≥–æ:</h4>
      <pre>{{ data.releaseNotes }}</pre>
    </div>
  </mat-card-content>
  <mat-card-actions>
    <button (click)="onCancel()">–ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ</button>
    <button (click)="onUpdate()">–û–±–Ω–æ–≤–∏—Ç—å</button>
  </mat-card-actions>
</mat-card>
```

---

### –®–∞–≥ 5: –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–±–Ω–æ–≤–∏—Ç—å"

```typescript
onUpdate(): void {
  this.dialogRef.close(true); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true
}
```

**StartupService** –ø–æ–ª—É—á–∞–µ—Ç `true`:

```typescript
dialogRef.afterClosed().subscribe(async (shouldUpdate: boolean) => {
  if (shouldUpdate) {
    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ');
    await this.updateService.downloadAndInstall(versionInfo.downloadUrl);
  }
});
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ"

```typescript
onCancel(): void {
  this.dialogRef.close(false); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç false
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ `required: true`, –∫–Ω–æ–ø–∫–∞ "–ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è!

---

### –®–∞–≥ 6: –ü—Ä–æ—Ü–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

**AppUpdateService.downloadAndInstall(url):**

#### 6.1 –û—Ç–∫—Ä—ã—Ç–∏–µ APK —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä

```typescript
const { Browser } = await import('@capacitor/browser');
await Browser.open({
  url: 'http://192.144.12.102:3001/app-debug.apk',
  windowName: '_system',
  presentationStyle: 'fullscreen',
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä Android
2. –ë—Ä–∞—É–∑–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ APK —Ñ–∞–π–ª–∞
3. Android –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ —ç—Ç–æ APK —Ñ–∞–π–ª
4. Android –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### 6.2 –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥ Android

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "Coffee Admin Panel"?   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ  ‚îÇ
‚îÇ  –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –í–µ—Ä—Å–∏—è: 1.0.2                      ‚îÇ
‚îÇ  –†–∞–∑–º–µ—Ä: 4.7 MB                     ‚îÇ
‚îÇ                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ        [–û—Ç–º–µ–Ω–∞]      [–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å]   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤":**

Android –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å:
```
–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∏—Ç–µ 
"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
```

#### 6.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ APK

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å":
1. Android —Å–∫–∞—á–∏–≤–∞–µ—Ç APK (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–∞—á–∞–Ω–æ)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ä–æ–π
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"

#### 6.4 –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  Coffee Admin Panel                 ‚îÇ
‚îÇ  —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–æ –≤–µ—Ä—Å–∏–∏ 1.0.2  ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ         [–ì–æ—Ç–æ–≤–æ]  [–û—Ç–∫—Ä—ã—Ç—å]        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

1. **–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** (1.0.2)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
   ```typescript
   currentVersion = "1.0.2"  // –ò–∑ –Ω–æ–≤–æ–≥–æ AndroidManifest.xml
   serverVersion = "1.0.2"   // –ò–∑ API
   ```
3. **–í–µ—Ä—Å–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç** ‚Üí –¥–∏–∞–ª–æ–≥ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
4. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ**

---

## üìã –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ—Ä—Å–∏—é 1.0.1
   ‚Üì
2. AppComponent.ngOnInit()
   ‚Üì
3. startupService.checkForUpdates()
   ‚Üì
4. appUpdateService.checkForUpdates()
   ‚Üì
5. HTTP GET /api/app/version
   ‚Üì
6. –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: {version: "1.0.2", ...}
   ‚Üì
7. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: "1.0.1" !== "1.0.2" ‚Üí true
   ‚Üì
8. dialog.open(AppUpdateComponent)
   ‚Üì
9. –î–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚Üì
10. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–±–Ω–æ–≤–∏—Ç—å"
    ‚Üì
11. dialogRef.close(true)
    ‚Üì
12. updateService.downloadAndInstall(url)
    ‚Üì
13. Browser.open({url: "http://...app-debug.apk"})
    ‚Üì
14. –°–∏—Å—Ç–µ–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
    ‚Üì
15. Android —Å–∫–∞—á–∏–≤–∞–µ—Ç APK
    ‚Üì
16. Android –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    ‚Üì
17. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
    ‚Üì
18. Android —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
    ‚Üì
19. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚Üì
20. –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è 1.0.2 —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

### –î–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Material Design)

```html
<!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–ª–æ–≥–∞ -->
<mat-card>
  <mat-card-header>
    <mat-icon color="primary">system_update_alt</mat-icon>
    –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!
  </mat-card-header>
  
  <mat-card-content>
    <p>–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è <strong>1.0.2</strong> –¥–æ—Å—Ç—É–ø–Ω–∞.</p>
    
    <!-- –ï—Å–ª–∏ required: true -->
    <p class="required-note">
      <mat-icon color="warn">warning</mat-icon>
      –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
    </p>
    
    <!-- Release notes -->
    <div class="release-notes">
      <h4>–ß—Ç–æ –Ω–æ–≤–æ–≥–æ:</h4>
      <pre>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫.</pre>
    </div>
  </mat-card-content>
  
  <mat-card-actions>
    <button mat-button (click)="onCancel()" 
            *ngIf="!data.required">
      –ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ
    </button>
    <button mat-raised-button color="primary" (click)="onUpdate()">
      <mat-icon>download</mat-icon>
      –û–±–Ω–æ–≤–∏—Ç—å
    </button>
  </mat-card-actions>
</mat-card>
```

### –°—Ç–∏–ª–∏ –¥–∏–∞–ª–æ–≥–∞:

```scss
mat-card {
  max-width: 500px;
  border-radius: 8px;
}

.required-note {
  color: #f44336; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
}

.release-notes pre {
  background-color: #f5f5f5;
  padding: 12px;
  border-radius: 4px;
  max-height: 200px;
  overflow-y: auto;
}
```

---

## üîç –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```
üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...
üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: android
üåê –ù–∞—Ç–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: true
üì± –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.1
üåê API URL: http://192.144.12.102:3001/api
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.1
üåê –ó–∞–ø—Ä–æ—Å –∫: http://192.144.12.102:3001/api/app/version
üì° –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {
  version: "1.0.2",
  downloadUrl: "http://192.144.12.102:3001/app-debug.apk",
  required: false,
  releaseNotes: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏..."
}
‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: 1.0.2
üì• URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: http://192.144.12.102:3001/app-debug.apk
‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: false
üì¢ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 1.0.2
```

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û–±–Ω–æ–≤–∏—Ç—å":

```
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
üì• –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å: http://192.144.12.102:3001/app-debug.apk
üì± –û—Ç–∫—Ä—ã–≤–∞–µ–º APK —Ñ–∞–π–ª –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏...
‚úÖ APK —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä
üì± Android –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 1. –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è

```typescript
// –í –Ω–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
const info = await App.getInfo();
const currentVersion = info.version; // "1.0.1"
// –≠—Ç–æ —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ AndroidManifest.xml (versionName –∏–∑ build.gradle)
```

### 2. –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```typescript
// localStorage –≤ –±—Ä–∞—É–∑–µ—Ä–µ/WebView
localStorage.setItem('app_update_last_check', Date.now().toString());
```

### 3. –ö–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è APK

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Capacitor Browser plugin
const { Browser } = await import('@capacitor/browser');
await Browser.open({
  url: downloadUrl,
  windowName: '_system', // –û—Ç–∫—Ä—ã—Ç—å –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
});
```

### 4. Fallback –º–µ—Ç–æ–¥—ã

–ï—Å–ª–∏ Browser plugin –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

```typescript
// –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç <a> –∏ –∫–ª–∏–∫–∞–µ–º
const link = document.createElement('a');
link.href = url;
link.target = '_system';
link.download = 'app-update.apk';
document.body.appendChild(link);
link.click();
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î–∏–∞–ª–æ–≥ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –Ω–µ–¥–∞–≤–Ω–æ (–º–µ–Ω–µ–µ 24 —á–∞—Å–æ–≤)
- –í–µ–±-–≤–µ—Ä—Å–∏—è (–Ω–µ –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
- –í–µ—Ä—Å–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø—Ä–æ–≤–µ—Ä–∫–∏
localStorage.removeItem('app_update_last_check');
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: APK –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (404)
- –ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å APK
curl -I http://192.144.12.102:3001/app-debug.apk

# –ó–∞–≥—Ä—É–∑–∏—Ç—å APK –Ω–∞ —Å–µ—Ä–≤–µ—Ä
./deploy-apk-v2.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –î–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞:** –í–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/app/version` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Ä—Å–∏—é 1.0.2
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ 1.0.1 –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –≤–µ—Ä—Å–∏–π
- [ ] –î–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç APK –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] Android –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- [ ] –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 1.0.2
- [ ] –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –¥–∏–∞–ª–æ–≥ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

---

–ì–æ—Ç–æ–≤–æ! üöÄ

