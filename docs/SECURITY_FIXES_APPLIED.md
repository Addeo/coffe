# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (2025-10-08)

### 1. ‚úÖ JWT Secret - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**

```typescript
secretOrKey: configService.get<string>('JWT_SECRET') || 'your-secret-key'; // ‚ö†Ô∏è –û–ü–ê–°–ù–û!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

```typescript
const secret = configService.get<string>('JWT_SECRET');

if (!secret) {
  throw new Error(
    'JWT_SECRET is not defined in environment variables! ' +
      'Please set JWT_SECRET in your .env file before starting the application.'
  );
}
```

**–§–∞–π–ª:** `backend/src/modules/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/jwt.strategy.ts`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ JWT_SECRET –≤ .env

---

### 2. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–±—Ä–∞–Ω–∞ –∏–∑ Git

**–ü—Ä–æ–±–ª–µ–º–∞:**

- `database.sqlite` - –±–∞–∑–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- `backend/database.sqlite` - –¥—É–±–ª–∏–∫–∞—Ç
- –õ—é–±–æ–π —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Git –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `.gitignore`:

```gitignore
# Databases - –ö–†–ò–¢–ò–ß–ù–û: –ù–ï –ó–ê–ì–†–£–ñ–ê–¢–¨ –í GIT!
*.sqlite
*.sqlite3
*.db
database.sqlite
backend/database.sqlite
```

2. –§–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ Git –∏–Ω–¥–µ–∫—Å–∞:

```bash
git rm --cached database.sqlite backend/database.sqlite
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–î –±–æ–ª—å—à–µ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ Git, –Ω–æ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ

---

### 3. ‚úÖ Uploads —É–±—Ä–∞–Ω—ã –∏–∑ Git

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `.gitignore`:

```gitignore
# Uploads and user files - –ù–ï –ó–ê–ì–†–£–ñ–ê–¢–¨ –í GIT!
uploads/
backend/uploads/
```

2. –§–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ Git:

```bash
git rm --cached -r backend/uploads/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Git

---

### 4. ‚úÖ Backups —É–±—Ä–∞–Ω—ã –∏–∑ Git

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

```gitignore
# Backups - –ù–ï –ó–ê–ì–†–£–ñ–ê–¢–¨ –í GIT!
backups/
backend/backups/
*.backup
*.bak
```

---

### 5. üìù –û–±–Ω–æ–≤–ª–µ–Ω env.example

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT_SECRET
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è dev –∏ prod
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤

**–§–∞–π–ª:** `env.example`

---

## üìö –ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 1. `DATABASE_SETUP.md`

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ë–î:

- –ü–æ—á–µ–º—É —Ä–∞–∑–Ω—ã–µ –ë–î - —ç—Ç–æ –ø–ª–æ—Ö–æ
- –ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ MySQL –≤–µ–∑–¥–µ —á–µ—Ä–µ–∑ Docker
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Å PostgreSQL
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

### 2. `docker-compose.dev.yml`

–ì–æ—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- MySQL 8.0
- phpMyAdmin –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

---

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
cp env.example .env
```

### –®–∞–≥ 2: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ JWT_SECRET

**–í–∞—Ä–∏–∞–Ω—Ç 1 (Node.js):**

```bash
node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 (OpenSSL):**

```bash
openssl rand -base64 64
```

**–í—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ .env:**

```env
JWT_SECRET=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç_–∑–¥–µ—Å—å
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ë–î

**–û–ø—Ü–∏—è A: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å SQLite (–±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```env
# –í .env –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å, SQLite –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
NODE_ENV=development
```

**–û–ø—Ü–∏—è B: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ MySQL —á–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ MySQL:

```bash
docker-compose -f docker-compose.dev.yml up -d
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
docker ps
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω coffee_admin_mysql_dev
```

4. –û–±–Ω–æ–≤–∏—Ç–µ .env:

```env
NODE_ENV=development
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=coffee_user
DB_PASSWORD=coffee_dev_password
DB_DATABASE=coffee_admin
```

### –®–∞–≥ 4: –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
git status

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# - modified: .gitignore
# - modified: backend/src/modules/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/jwt.strategy.ts
# - modified: env.example
# - deleted: database.sqlite
# - deleted: backend/database.sqlite
# - deleted: backend/uploads/*
# - deleted: backend/backups/*
# - new: docker-compose.dev.yml
# - new: docs/DATABASE_SETUP.md
# - new: docs/SECURITY_FIXES_APPLIED.md

# –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ
git add .
git commit -m "üîí Security fixes: JWT validation, remove DB and uploads from git, update gitignore"
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–æ–Ω–∏ –≤ gitignore)

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–æ –æ–Ω–∏ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ git
mkdir -p backend/uploads
mkdir -p backend/backups

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ–∑–¥–∞–π—Ç–µ .gitkeep —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
touch backend/uploads/.gitkeep
touch backend/backups/.gitkeep

# –ò –¥–æ–±–∞–≤—å—Ç–µ .gitkeep –≤ .gitignore –∏—Å–∫–ª—é—á–µ–Ω–∏—è
echo "!**/.gitkeep" >> .gitignore
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# Backend
cd backend
npm run start:dev

# –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–∏–±–æ:
# - Error: JWT_SECRET is not defined (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ .env)
# - Coffee Admin API is running... (–µ—Å–ª–∏ –≤—Å–µ –û–ö)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

### –î–ª—è –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

1. **–ö–∞–∂–¥—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω:**
   - –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π .env —Ñ–∞–π–ª (–æ–Ω –≤ .gitignore)
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π JWT_SECRET
   - –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å .env –≤ Git!

2. **–ë–î –∏ uploads:**
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏—Ö –≤ Git
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ç–∫–∞–ø—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
   - –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ seed scripts

3. **Production:**
   - JWT_SECRET –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è prod
   - –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1Password, AWS Secrets Manager)
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dev —Å–µ–∫—Ä–µ—Ç—ã –≤ prod!

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–π `database.sqlite`:

```bash
# 1. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø
cp database.sqlite database.sqlite.backup

# 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ (—Å–æ–∑–¥–∞–π—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ –Ω–æ–≤—É—é –ë–î (MySQL)
# –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MySQL —á–µ—Ä–µ–∑ docker-compose.dev.yml
```

---

## üìä –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```
‚úÖ JWT_SECRET –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
‚úÖ .env —Ñ–∞–π–ª –≤ .gitignore
‚úÖ database.sqlite –≤ .gitignore –∏ —É–¥–∞–ª–µ–Ω –∏–∑ Git
‚úÖ uploads/ –≤ .gitignore –∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ Git
‚úÖ backups/ –≤ .gitignore –∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ Git
‚úÖ env.example –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
‚úÖ docker-compose.dev.yml —Å–æ–∑–¥–∞–Ω
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

‚ùå TODO: CORS –≤—Å–µ –µ—â–µ origin: true (—Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)
‚ùå TODO: –ù–µ—Ç helmet –∏ rate-limiting
‚ùå TODO: –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
```

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS** (30 –º–∏–Ω—É—Ç)
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å allowed origins
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

2. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç–Ω—ã–µ middleware** (1 —á–∞—Å)
   - helmet
   - rate-limiting
   - compression

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** (2 —á–∞—Å–∞)
   - TypeORM migrations
   - –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

4. **–ù–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Ç–µ—Å—Ç—ã** (4 —á–∞—Å–∞)
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üìû –í–æ–ø—Ä–æ—Å—ã?

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `docker logs coffee_admin_mysql_dev`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

**–ü–æ–º–Ω–∏—Ç–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –Ω–µ —Å–æ–±—ã—Ç–∏–µ. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

---

**–î–∞—Ç–∞:** 2025-10-08  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π:** CORS –∏ middleware –∑–∞—â–∏—Ç—ã
