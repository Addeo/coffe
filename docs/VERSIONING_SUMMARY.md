# –°–≤–æ–¥–∫–∞ –ø–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Ä—Å–∏—è –±—ã–ª–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–∞ –≤ `AppUpdateService` –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –í–µ—Ä—Å–∏—è —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `environment.ts` –∫–∞–∫ `appVersion: '1.0.1'`
- –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `AppUpdateService` —á–∏—Ç–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∏–∑ `environment.ts`
- –í –Ω–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Capacitor App API

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –º–µ–∂–¥—É —Ç–µ–∫—É—â–µ–π –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ environment (–∑–∞—à–∏—Ç–∞ –≤ –∫–æ–¥)
const currentVersion = environment.appVersion;

// –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è —Å backend
const serverVersion = await http.get('/api/app/version');

// –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
if (serverVersion !== currentVersion) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

### 3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ login
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å —Å backend –≤–º–µ—Å—Ç–æ –ø–æ–∫–∞–∑–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ë—ã–ª–æ: –∑–∞–≥—Ä—É–∑–∫–∞ —Å backend
this.http.get('/api/app/version').subscribe(...)

// –°—Ç–∞–ª–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞—à–∏—Ç–æ–π –≤–µ—Ä—Å–∏–∏
appVersion = signal(environment.appVersion);
```

### 4. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ APK –¥–ª—è Android
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `App.openUrl()` API.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–ª—è Android –∏—Å–ø–æ–ª—å–∑—É–µ–º window.open —Å target='_system'
const link = document.createElement('a');
link.href = url;
link.target = '_system';
link.click();
```

## üìã –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Frontend
```typescript
// environment.ts –∏ environment.prod.ts
appVersion: '1.0.1' // ‚Üê Fallback –≤–µ—Ä—Å–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤–µ–±-–≤–µ—Ä—Å–∏–∏)
```

### Backend
```typescript
// app.controller.ts
version: '1.0.2' // ‚Üê –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
downloadUrl: 'http://localhost:8080/app-debug.apk'
```

### Android
```gradle
// build.gradle
versionCode 1
versionName "1.0.1" // ‚Üê –†–ï–ê–õ–¨–ù–ê–Ø –≤–µ—Ä—Å–∏—è –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í –Ω–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ `AndroidManifest.xml` (versionName), –∞ –ù–ï –∏–∑ `environment.ts`!

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```
AppComponent.ngOnInit()
  ‚Üì
StartupService.checkForUpdates()
  ‚Üì
AppUpdateService.checkForUpdates()
```

### –®–∞–≥ 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
```
currentVersion (1.0.1) ‚â† serverVersion (1.0.2)
  ‚Üì
–ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

### –®–∞–≥ 3: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–±–Ω–æ–≤–∏—Ç—å"
  ‚Üì
AppUpdateService.downloadAndInstall(url)
  ‚Üì
Android –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```
Android —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
  ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  ‚Üì
–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–¥–∞**
   - –ó–∞—à–∏—Ç–∞ –≤ `environment.ts` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç backend

2. **–í–µ—Ä—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API**
   - `/api/app/version` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
   - –ú–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –µ—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
   - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –µ—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç

4. **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ APK —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Android**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
   - Android –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É

5. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ login**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å backend

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ –∫–æ–¥–µ:**
   ```bash
   # environment.ts
   appVersion: '1.0.2'
   
   # environment.prod.ts
   appVersion: '1.0.2'
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   # app.controller.ts
   version: '1.0.2'
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å Android –≤–µ—Ä—Å–∏—é:**
   ```bash
   # build.gradle
   versionCode 2
   versionName "1.0.2"
   ```

4. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   ng build --configuration production
   npx cap sync android
   ```

5. **–í—ã–ª–æ–∂–∏—Ç—å APK –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   # –†–∞–∑–º–µ—Å—Ç–∏—Ç—å APK –ø–æ URL –∏–∑ downloadUrl
   ```

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏:**
   - Frontend: `1.0.1`
   - Backend: `1.0.2`

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   # –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```
   üì± –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: 1.0.1
   üì° –í–µ—Ä—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: 1.0.2
   ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: 1.0.2
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ:**
   ```
   üì• –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å: http://localhost:8080/app-debug.apk
   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
   ```

## ‚ùì FAQ: –ò–∑–º–µ–Ω–∏—Ç—Å—è –ª–∏ –≤–µ—Ä—Å–∏—è –≤ environment –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?

### –û—Ç–≤–µ—Ç: –ù–ï–¢! Environment –ù–ï –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–ü—Ä–∏ —Å–±–æ—Ä–∫–µ:**
   ```typescript
   // environment.ts
   appVersion: '1.0.1' // ‚Üê –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–¥
   ```

2. **–í –Ω–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   ```typescript
   // –í–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ AndroidManifest.xml
   const info = await App.getInfo();
   info.version = "1.0.1" // ‚Üê –ò–∑ build.gradle
   ```

3. **–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ APK:**
   ```typescript
   // Environment –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º ('1.0.1')
   // –ù–û –≤–µ—Ä—Å–∏—è –≤ AndroidManifest.xml –∏–∑–º–µ–Ω—è–µ—Ç—Å—è ('1.0.2')
   const info = await App.getInfo();
   info.version = "1.0.2" // ‚Üê –ò–∑ –ù–û–í–û–ì–û build.gradle
   ```

**–í—ã–≤–æ–¥:** 
- ‚ùå Environment –ù–ï –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- ‚úÖ –í–µ—Ä—Å–∏—è –≤ AndroidManifest.xml –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–æ–≤–æ–≥–æ APK
- ‚úÖ AppUpdateService —á–∏—Ç–∞–µ—Ç –†–ï–ê–õ–¨–ù–£–Æ –≤–µ—Ä—Å–∏—é –∏–∑ `App.getInfo()`

## üîí –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞
–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –≤—Ä–µ–º–µ–Ω–∏:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ —á–∞—â–µ **—Ä–∞–∑ –≤ 24 —á–∞—Å–∞**
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`
- –í–µ–±-–≤–µ—Ä—Å–∏—è **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ–æ–±—â–µ

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
if (!Capacitor.isNativePlatform()) {
  return null; // –í–µ–±-–≤–µ—Ä—Å–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
const lastCheck = getLastCheckTime();
if (lastCheck && (now - lastCheck) < 24 * 60 * 60 * 1000) {
  return null; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ
}
```

## ‚úÖ –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è Ionic/Capacitor –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- ‚úÖ –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ AndroidManifest.xml (–Ω–∞—Ç–∏–≤–Ω–æ–µ) –∏–ª–∏ environment.ts (–≤–µ–±)
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ APK –¥–ª—è Android —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ login –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ Environment –ù–ï –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- ‚úÖ **–í–µ–±-–≤–µ—Ä—Å–∏—è –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (—Ä–∞–∑ –≤ 24 —á–∞—Å–∞)**

