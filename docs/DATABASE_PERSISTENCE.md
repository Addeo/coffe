# üóÑÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ (–î–û)

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ GitHub Actions –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–ª–∞—Å—å**:

```yaml
# –°–¢–ê–†–´–ô –ö–û–î - –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï!
docker-compose down -v  # ‚ö†Ô∏è –§–ª–∞–≥ -v —É–¥–∞–ª—è–µ—Ç volumes!
docker volume rm coffe_mysql_data  # ‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö MySQL!
docker system prune -af --volumes  # ‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö volumes!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚ùå –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª—è–ª–∏—Å—å
- ‚ùå –í—Å–µ –∑–∞–∫–∞–∑—ã —É–¥–∞–ª—è–ª–∏—Å—å
- ‚ùå –í—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —É–¥–∞–ª—è–ª–∏—Å—å
- ‚ùå –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è–ª–∏—Å—å

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ (–ü–û–°–õ–ï)

–¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** –≤—Å–µ –¥–∞–Ω–Ω—ã–µ:

```yaml
# –ù–û–í–´–ô –ö–û–î - –ë–ï–ó–û–ü–ê–°–ù–´–ô!
docker-compose down --remove-orphans  # ‚úÖ –ë–ï–ó —Ñ–ª–∞–≥–∞ -v!
docker image prune -af                # ‚úÖ –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
# –ù–ï–¢ —É–¥–∞–ª–µ–Ω–∏—è volumes                # ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è
- ‚úÖ –ó–∞–∫–∞–∑—ã –æ—Å—Ç–∞—é—Ç—Å—è
- ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è

---

## üì¶ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Docker Volumes

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

```
docker-compose.prod.yml
‚îú‚îÄ‚îÄ volumes:
‚îÇ   ‚îú‚îÄ‚îÄ mysql_data:         # ‚Üê –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MySQL
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ /var/lib/mysql
‚îÇ   ‚îî‚îÄ‚îÄ uploads_data:       # ‚Üê –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ       ‚îî‚îÄ‚îÄ /app/uploads
```

### –ì–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ:

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
/var/lib/docker/volumes/
‚îú‚îÄ‚îÄ coffe_mysql_data/    # MySQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ coffe_uploads_data/  # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

---

## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

### 1. **–û–±—ã—á–Ω—ã–π –¥–µ–ø–ª–æ–π (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)**

```bash
cd ~/coffe
docker-compose -f docker-compose.prod.yml down --remove-orphans
# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, volumes –æ—Å—Ç–∞—é—Ç—Å—è

docker-compose -f docker-compose.prod.yml build --no-cache
# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–±—Ä–∞–∑—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

docker-compose -f docker-compose.prod.yml up -d
# –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –°–£–©–ï–°–¢–í–£–Æ–©–ò–ú–ò –¥–∞–Ω–Ω—ã–º–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞
- ‚úÖ –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–µ—Å—Ç–µ

---

### 2. **–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é!)**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
./clean-deploy.sh

# –ò–õ–ò –≤—Ä—É—á–Ω—É—é:
docker-compose -f docker-compose.prod.yml down -v
docker volume rm coffe_mysql_data coffe_uploads_data
docker-compose -f docker-compose.prod.yml up -d --build
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker exec coffee_mysql_prod mysqldump \
  -u coffee_user \
  -pcoffee_password \
  coffee_admin > backup_$(date +%Y%m%d_%H%M%S).sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker exec -i coffee_mysql_prod mysql \
  -u coffee_user \
  -pcoffee_password \
  coffee_admin < backup_20231215_120000.sql
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø (cron):

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
crontab -e

# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø –≤ 3:00
0 3 * * * docker exec coffee_mysql_prod mysqldump -u coffee_user -pcoffee_password coffee_admin > ~/backups/db_$(date +\%Y\%m\%d).sql
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ volumes

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ volumes:

```bash
docker volume ls | grep coffe
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
local     coffe_mysql_data
local     coffe_uploads_data
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:

```bash
docker system df -v | grep coffe
```

### –ò–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å volume:

```bash
docker volume inspect coffe_mysql_data
```

---

## üö® –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:

1. **TypeORM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend
2. **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** (—Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—è–µ—Ç—Å—è)
3. **–û—Ç–∫–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω** —á–µ—Ä–µ–∑ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤ `backend/migrations/`

### –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker exec -it coffee_backend_prod npm run migration:run
```

---

## ‚úÖ Checklist –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

- [x] ‚úÖ –î–∞–Ω–Ω—ã–µ MySQL —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [x] ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [x] ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [x] ‚úÖ GitHub Actions –Ω–µ —É–¥–∞–ª—è–µ—Ç volumes
- [x] ‚úÖ –ï—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ (`clean-deploy.sh`)

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º:**

   ```bash
   # –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø!
   ./backup-database.sh
   ```

2. **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**

   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ
   docker exec -it coffee_mysql_prod mysql -u coffee_user -pcoffee_password -e "SELECT COUNT(*) FROM coffee_admin.users;"
   ```

3. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —á–µ—Ä–µ–∑ cron
   - –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ/–æ–±–ª–∞–∫–µ
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤

---

## üéØ –ò—Ç–æ–≥

‚úÖ **–¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π –±–µ–∑–æ–ø–∞—Å–µ–Ω!**

- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
- –¢–æ–ª—å–∫–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π

‚ùå **–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./clean-deploy.sh`
- –¢—Ä–µ–±—É–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ù–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
