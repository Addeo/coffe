# API Security Audit Report

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: Organizations Controller

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `OrganizationsController` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@Roles` –Ω–∞ –º–µ—Ç–æ–¥–∞—Ö, –Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@UseGuards(JwtAuthGuard, RolesGuard)` –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

**–§–∞–π–ª:** `backend/src/modules/organizations/organizations.controller.ts`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```typescript
@Controller('organizations')
export class OrganizationsController {
  @Post()
  @Roles(UserRole.ADMIN) // ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ RolesGuard!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
@Controller('organizations')
@UseGuards(JwtAuthGuard, RolesGuard) // ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
export class OrganizationsController {
```

### 2. ‚ö†Ô∏è –í–ê–ñ–ù–û: Products Controller

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ª—é–±–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π.

**–§–∞–π–ª:** `backend/src/modules/products/products.controller.ts`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- `POST /products` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ADMIN, MANAGER
- `PATCH /products/:id` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ADMIN, MANAGER
- `DELETE /products/:id` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ADMIN
- `PATCH /products/:id/stock` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å MANAGER, ADMIN
- `POST /products/bulk/status` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ADMIN
- `GET /products*` - –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º

### 3. ‚ö†Ô∏è –í–ê–ñ–ù–û: Files Controller

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π.

**–§–∞–π–ª:** `backend/src/modules/files/files.controller.ts`

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /files` - –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `GET /files/stats` - –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `GET /files/my-files` - –±–µ–∑ JwtAuthGuard (–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç req.user)
- `GET /files/get-order-files/:orderId` - –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `GET /files/view/:id` - –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `POST /files/:id/attach-to-order` - guard –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- `GET /files/metadata/:id` - –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è (–¥–≤–∞ –º–µ—Ç–æ–¥–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –ø—É—Ç–µ–º)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã (view) –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –õ–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å ADMIN –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞

### 4. ‚ö†Ô∏è –°–†–ï–î–ù–ï: Statistics Controller

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–§–∞–π–ª:** `backend/src/modules/statistics/statistics.controller.ts`

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –±–µ–∑ @Roles (–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º):**
- `GET /statistics/earnings` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–û–ö)
- `GET /statistics/earnings/comparison` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (–û–ö)
- `GET /statistics/earnings/rank` - —Ä–µ–π—Ç–∏–Ω–≥ (–û–ö)
- `GET /statistics/engineer/detailed` - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–û–ö, –Ω–æ –¥–æ–ª–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ req.user.id)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

### 5. ‚ö†Ô∏è –°–†–ï–î–ù–ï: Work Sessions Controller

**–ü—Ä–æ–±–ª–µ–º–∞:** `GET /work-sessions/:id` –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ —Å–µ—Å—Å–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - MANAGER/ADMIN.

### 6. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã:

- ‚úÖ `UsersController` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- ‚úÖ `OrdersController` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- ‚úÖ `SalaryPaymentController` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- ‚úÖ `EngineerOrganizationRatesController` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- ‚úÖ `CalculationsController` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- ‚úÖ `StatisticsController` - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ `NotificationsController` - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `@UseGuards(JwtAuthGuard, RolesGuard)` –≤ `OrganizationsController`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π –≤ `ProductsController`
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `FilesController`
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `GET /files/metadata/:id`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–µ):
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤ `WorkSessionsController.getWorkSession`

## üîê –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@UseGuards(JwtAuthGuard, RolesGuard)` –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞**, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
2. **–î–æ–±–∞–≤–ª—è—Ç—å `@Roles()` –Ω–∞ –º–µ—Ç–æ–¥—ã**, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–æ–ª–∏
3. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–∞** –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º (orders, files, sessions)
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö** - –¥–∞–∂–µ –µ—Å–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω, –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
5. **–ù–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å guards** –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø** –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π –∫ –∫–∞–∂–¥–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º

| –ú–æ–¥—É–ª—å | USER | MANAGER | ADMIN |
|--------|------|---------|-------|
| Orders - —Å–æ–∑–¥–∞—Ç—å | ‚ùå | ‚úÖ | ‚úÖ |
| Orders - –ø—Ä–∏–Ω—è—Ç—å | ‚úÖ | ‚ùå | ‚ùå |
| Orders - –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É | ‚úÖ | ‚ùå | ‚ùå |
| Orders - –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∏–Ω–∂–µ–Ω–µ—Ä–∞ | ‚ùå | ‚úÖ | ‚úÖ |
| Users - —Å–ø–∏—Å–æ–∫ | ‚ùå | ‚úÖ | ‚úÖ |
| Users - —Å–æ–∑–¥–∞—Ç—å | ‚ùå | ‚ùå | ‚úÖ |
| Organizations - —Å–ø–∏—Å–æ–∫ | ‚ùå | ‚úÖ | ‚úÖ |
| Organizations - —Å–æ–∑–¥–∞—Ç—å | ‚ùå | ‚ùå | ‚úÖ |
| Statistics - –æ–±—â–∞—è | ‚ùå | ‚úÖ | ‚úÖ |
| Statistics - —Å–≤–æ—è | ‚úÖ | ‚úÖ | ‚úÖ |
| Payments - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | ‚ùå | ‚úÖ | ‚úÖ |
| Calculations - –∑–∞–ø—É—Å–∫ | ‚ùå | ‚úÖ | ‚úÖ |
| Calculations - –ø—Ä–æ—Å–º–æ—Ç—Ä | ‚úÖ | ‚úÖ | ‚úÖ |
| Files - —Å–≤–æ–∏ | ‚úÖ | ‚úÖ | ‚úÖ |
| Files - –≤—Å–µ | ‚ùå | ‚ùå | ‚úÖ |

