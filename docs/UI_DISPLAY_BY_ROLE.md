# Отображение данных по ролям в интерфейсе

## Обзор

Данные о расчётах отображаются **по-разному** в зависимости от роли пользователя для обеспечения безопасности и релевантности информации.

## 🔵 Инженер (USER)

### Что видит инженер в заказе:

#### Основная информация ✅
- Название заказа
- Описание
- Локация
- Статус
- Назначенная организация (только название)

#### Данные о работе ✅
- Обычные часы работы
- Часы переработки
- Расстояние
- Тип территории
- Примечания о работе

#### Оплата (упрощённый вид) ✅
```
┌──────────────────────────────────┐
│  💰 Ваша оплата                  │
├──────────────────────────────────┤
│  Оплата за работу:    7,700 ₽   │
│  Доплата за машину:     500 ₽   │
│  ──────────────────────────────  │
│  ИТОГО к выплате:     8,200 ₽   │
└──────────────────────────────────┘
```

#### Что НЕ видит инженер ❌
- ❌ Ставки организации
- ❌ Оплата от организации
- ❌ Прибыль компании
- ❌ Детальная разбивка расчётов
- ❌ Индивидуальные ставки

---

## 🔴 Администратор / Менеджер (ADMIN / MANAGER)

### Что видит админ/менеджер в заказе:

#### Основная информация ✅
- Вся информация, что видит инженер
- + Источник заказа
- + Фактические даты начала/завершения

#### Оплата (детальный вид) ✅

##### 1. Оплата инженеру
```
┌──────────────────────────────────┐
│  💰 Оплата инженеру              │
├──────────────────────────────────┤
│  Оплата за работу:    7,700 ₽   │
│  Доплата за машину:     500 ₽   │
│  ──────────────────────────────  │
│  ИТОГО инженеру:      8,200 ₽   │
└──────────────────────────────────┘
```

##### 2. Оплата от организации
```
┌──────────────────────────────────┐
│  🏢 Оплата от организации        │
├──────────────────────────────────┤
│  Оплата от организации: 9,900 ₽  │
│  Доплата за машину:       500 ₽  │
│  ──────────────────────────────  │
│  ИТОГО от организации: 10,400 ₽  │
└──────────────────────────────────┘
```

##### 3. Прибыль
```
┌──────────────────────────────────┐
│  📈 Прибыль                      │
├──────────────────────────────────┤
│  Наша прибыль:        2,200 ₽   │
└──────────────────────────────────┘
```

##### 4. Детальная разбивка расчёта ✨ НОВОЕ!
```
┌──────────────────────────────────────────┐
│  🧮 Детальная разбивка расчёта          │
├──────────────────────────────────────────┤
│  📊 Ставки инженера:                     │
│    • Базовая ставка:          700 ₽/ч   │
│    • Ставка переработки:    1,050 ₽/ч   │
│                                          │
│  🏢 Ставки организации:                  │
│    • Базовая ставка:          900 ₽/ч   │
│    • Коэффициент переработки:    1.5    │
│                                          │
│  💵 Расчёт оплаты инженеру:             │
│    • За обычные часы:       5,600 ₽     │
│    • За переработку:        2,100 ₽     │
│                                          │
│  💼 Расчёт оплаты от организации:       │
│    • За обычные часы:       7,200 ₽     │
│    • За переработку:        2,700 ₽     │
└──────────────────────────────────────────┘
```

---

## Сравнительная таблица

| Данные | Инженер | Админ/Менеджер |
|--------|---------|----------------|
| **Основная информация** | | |
| Название, описание, локация | ✅ | ✅ |
| Статус заказа | ✅ | ✅ |
| Назначенный инженер | ❌ | ✅ |
| Источник заказа | ❌ | ✅ |
| Даты (плановые/фактические) | Частично | ✅ Полностью |
| **Данные о работе** | | |
| Часы работы | ✅ | ✅ |
| Расстояние, территория | ✅ | ✅ |
| Примечания | ✅ | ✅ |
| **Финансовая информация** | | |
| Оплата инженеру | ✅ Итого | ✅ С разбивкой |
| Оплата от организации | ❌ | ✅ |
| Прибыль | ❌ | ✅ |
| **Детальные расчёты** | | |
| Ставки инженера | ❌ | ✅ |
| Ставки организации | ❌ | ✅ |
| Разбивка по типам оплаты | ❌ | ✅ |
| Коэффициенты | ❌ | ✅ |

---

## Логика отображения в коде

### Условие для инженера:
```typescript
*ngIf="isEngineer"
```
Показывает **упрощённую** информацию об оплате.

### Условие для админа/менеджера:
```typescript
*ngIf="isAdminOrManager()"
```
Показывает **полную детализацию** с разбивкой, ставками и прибылью.

### Детальная разбивка (только админ):
```typescript
*ngIf="order?.engineerBaseRate || order?.organizationBaseRate"
```
Показывается автоматически, если в заказе есть сохранённые ставки.

---

## Примеры использования

### Инженер открывает свой заказ:
1. ✅ Видит, сколько ему заплатят (7,700 ₽ + 500 ₽)
2. ❌ Не видит, сколько платит организация
3. ❌ Не видит прибыль компании
4. ❌ Не видит детальную разбивку ставок

### Админ открывает заказ:
1. ✅ Видит оплату инженеру (7,700 ₽ + 500 ₽)
2. ✅ Видит оплату от организации (9,900 ₽ + 500 ₽)
3. ✅ Видит прибыль (2,200 ₽)
4. ✅ Видит детальную разбивку:
   - Ставки инженера (700 ₽/ч, 1,050 ₽/ч)
   - Ставки организации (900 ₽/ч, коэф. 1.5)
   - Разбивку по обычным часам и переработке
   - Итоговые расчёты

---

## Безопасность данных

### Защита на уровне UI:
- Использование `*ngIf` с проверкой роли
- Условное отображение компонентов

### Защита на уровне API:
- Backend фильтрует данные по роли пользователя
- Чувствительные данные не отправляются инженерам

### Аудит:
- Все расчёты сохраняются в Order
- Можно проверить историю изменений
- Прозрачность для администрации

---

## Что дальше

### Планируемые улучшения:
1. 📊 Экспорт детальных расчётов в PDF/Excel (для админов)
2. 📈 Графики анализа прибыльности (для админов)
3. 🔔 Уведомления о расхождениях в расчётах
4. 📝 История изменений ставок

