#!/bin/bash

# ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –Ω–æ –°–û–•–†–ê–ù–Ø–ï–¢ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!
# –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ë–î —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ.

set -e

echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï! ‚ö†Ô∏è"
echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –Ω–æ –°–û–•–†–ê–ù–ò–¢ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö."
echo "–í—ã —É–≤–µ—Ä–µ–Ω—ã? (yes/no)"
read -r CONFIRM

if [ "$CONFIRM" != "yes" ]; then
  echo "–û—Ç–º–µ–Ω–µ–Ω–æ."
  exit 0
fi

echo "üî¥ –í–≤–µ–¥–∏—Ç–µ 'STOP CONTAINERS' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:"
read -r FINAL_CONFIRM

if [ "$FINAL_CONFIRM" != "STOP CONTAINERS" ]; then
  echo "–û—Ç–º–µ–Ω–µ–Ω–æ."
  exit 0
fi

echo "üóëÔ∏è  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ë–ï–ó —É–¥–∞–ª–µ–Ω–∏—è volumes
docker-compose -f docker-compose.prod.yml down --remove-orphans

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ü–û–õ–ù–û–°–¢–¨–Æ —É–¥–∞–ª–∏—Ç—å volumes (–≤–∫–ª—é—á–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö), —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
# docker-compose -f docker-compose.prod.yml down -v --remove-orphans
# docker volume rm coffe_mysql_data coffe_uploads_data 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã coffee
docker rm -f $(docker ps -aq --filter 'name=coffee_') 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º —Å–µ—Ç—å
docker network rm coffe_coffee_prod_network 2>/dev/null || true

# –û—á–∏—â–∞–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã (–ë–ï–ó volumes)
docker system prune -af

echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!"
echo ""
echo "‚ö†Ô∏è  –î–ª—è –ü–û–õ–ù–û–ì–û —É–¥–∞–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—è –ë–î —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ"
echo ""
echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "docker-compose -f docker-compose.prod.yml up -d --build"


















