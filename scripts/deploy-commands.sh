#!/bin/bash

# ============================================
# Quick Production Deploy Commands
# –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
# ============================================

echo "üöÄ Coffee Admin - Production Migration Deploy"
echo "=============================================="
echo ""
echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–æ–º–∞–Ω–¥ –Ω–∏–∂–µ:"
echo ""
echo "1Ô∏è‚É£  –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –î–ï–ü–õ–û–ô (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):"
echo "   bash scripts/apply-production-seed.sh"
echo ""
echo "2Ô∏è‚É£  –†–£–ß–ù–û–ô –î–ï–ü–õ–û–ô:"
echo "   # –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä"
echo "   scp scripts/seed-production-orders.sql user1@192.144.12.102:~/coffe/"
echo ""
echo "   # –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É"
echo "   ssh user1@192.144.12.102"
echo ""
echo "   # –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é"
echo "   cd ~/coffe"
echo "   DB_PASSWORD=\$(grep MYSQL_ROOT_PASSWORD docker-compose.fallback.yml | awk '{print \$2}')"
echo "   docker exec -i coffee_mysql_fallback mysql -uroot -p\"\${DB_PASSWORD}\" coffee_db < seed-production-orders.sql"
echo ""
echo "3Ô∏è‚É£  –ü–†–û–í–ï–†–ò–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢:"
echo "   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "   docker exec -i coffee_mysql_fallback mysql -uroot -p\"\${DB_PASSWORD}\" coffee_db -e \\"
echo "     \"SELECT status, COUNT(*) as count FROM orders \\"
echo "     WHERE createdAt >= DATE_FORMAT(NOW(), '%Y-%m-01') \\"
echo "     GROUP BY status;\""
echo ""
echo "   # –ò–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:"
echo "   https://coffe-ug.ru/orders"
echo ""
echo "4Ô∏è‚É£  –û–¢–ö–ê–¢ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):"
echo "   docker exec -i coffee_mysql_fallback mysql -uroot -p\"\${DB_PASSWORD}\" coffee_db -e \\"
echo "     \"DELETE FROM orders WHERE createdAt >= DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 1 MONTH), '%Y-%m-01');\""
echo ""
echo "=============================================="
echo "üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: migration_guide.md"
echo "=============================================="
